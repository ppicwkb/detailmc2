<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stok Cs Wkb</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segui UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            min-height: 100vh;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
            color: #1a202c;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 107, 107, 0.3) 0%, transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(78, 205, 196, 0.25) 0%, transparent 60%),
                radial-gradient(circle at 40% 40%, rgba(255, 195, 113, 0.2) 0%, transparent 60%),
                radial-gradient(circle at 60% 70%, rgba(199, 125, 255, 0.25) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(30px);
            border-radius: 0;
            box-shadow: 
                0 0 0 1px rgba(255, 255, 255, 0.3),
                0 25px 50px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            overflow: hidden;
            min-height: 100vh;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.03) 0%, 
                rgba(16, 185, 129, 0.02) 25%,
                rgba(168, 85, 247, 0.02) 50%,
                rgba(245, 158, 11, 0.02) 75%,
                transparent 100%);
            pointer-events: none;
            z-index: 0;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: #ffffff;
            padding: 32px 24px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 
                0 8px 32px rgba(102, 126, 234, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(20px);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(59, 130, 246, 0.1) 25%, 
                rgba(16, 185, 129, 0.08) 50%, 
                rgba(168, 85, 247, 0.06) 75%, 
                transparent 100%);
            pointer-events: none;
            animation: headerGlow 15s ease-in-out infinite;
        }

        @keyframes headerGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            margin: 0;
            font-size: 2.25rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 50%, #e0f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.025em;
            text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5);
            filter: drop-shadow(0 2px 4px rgba(255, 255, 255, 0.3));
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)); }
            50% { filter: drop-shadow(0 4px 8px rgba(59, 130, 246, 0.4)); }
        }

        .header p {
            margin: 12px 0 0 0;
            opacity: 0.9;
            font-size: 1rem;
            font-weight: 500;
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
        }

        .controls {
            padding: 24px 32px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(240, 249, 255, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 
                0 4px 16px rgba(102, 126, 234, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
        }

        .controls::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(59, 130, 246, 0.3) 25%,
                rgba(16, 185, 129, 0.2) 50%,
                rgba(168, 85, 247, 0.2) 75%,
                transparent 100%);
        }

        .search-box {
            flex: 1;
            min-width: 320px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 16px 20px 16px 56px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 16px;
            font-size: 16px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            font-weight: 500;
            box-shadow: 
                0 4px 12px rgba(102, 126, 234, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            color: #1a202c;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 
                0 0 0 4px rgba(102, 126, 234, 0.3), 
                0 8px 24px rgba(102, 126, 234, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
        }

        .search-box input::placeholder {
            color: #718096;
            font-weight: 400;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 18px;
        }

        .load-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: #ffffff;
            border: 2px solid rgba(102, 126, 234, 0.3);
            padding: 16px 32px;
            border-radius: 16px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            box-shadow: 
                0 6px 20px rgba(102, 126, 234, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .load-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
        }

        .load-btn:hover::before {
            left: 100%;
        }

        .load-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 12px 32px rgba(59, 130, 246, 0.6),
                0 0 0 1px rgba(59, 130, 246, 0.5),
                inset 0 1px 0 rgba(148, 163, 184, 0.3);
            border-color: rgba(59, 130, 246, 0.6);
        }

        .load-btn:active {
            transform: translateY(-1px);
        }

        .load-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .modal-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .modal-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            padding: 15px 30px;
            text-align: center;
            font-size: 16px;
            font-weight: 500;
        }

        .status.loading {
            color: #2563eb;
            background: #eff6ff;
        }

        .status.error {
            color: #dc2626;
            background: #fef2f2;
        }

        .status.success {
            color: #059669;
            background: #f0fdf4;
        }

        .table-container {
            overflow-x: auto;
            max-height: 70vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .table-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.02) 0%, 
                rgba(118, 75, 162, 0.02) 50%, 
                rgba(16, 185, 129, 0.02) 100%);
            border-radius: 20px;
            pointer-events: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            border-radius: 12px;
            overflow: hidden;
        }

        th {
            background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
            color: white;
            padding: 20px 16px;
            text-align: left;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
            font-size: 14px;
            letter-spacing: 0.025em;
            border-bottom: 2px solid rgba(37, 99, 235, 0.4);
            backdrop-filter: blur(10px);
            position: relative;
        }

        th::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, rgba(37, 99, 235, 0.6) 50%, transparent 100%);
        }

        td {
            padding: 14px;
            border-bottom: 1px solid #f1f5f9;
            white-space: nowrap;
            font-weight: 500;
        }

        tr:hover {
            background-color: #f8fafc;
            transform: scale(1.001);
            transition: all 0.2s ease;
        }

        tr:nth-child(even) {
            background-color: #fafbfc;
        }

        tr:nth-child(even):hover {
            background-color: #f1f5f9;
        }

        .numeric {
            text-align: right;
            font-family: 'Monaco', 'Menlo', monospace;
            font-weight: 500;
        }

        .brand-cell {
            font-weight: 600;
            color: #374151;
        }

        .date-cell {
            color: #6b7280;
        }

        .code-cell {
            font-family: 'Monaco', 'Menlo', monospace;
            background: #f3f4f6;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats {
            padding: 32px 24px;
            background: linear-gradient(135deg, rgba(248,250,252,0.9) 0%, rgba(226,232,240,0.9) 100%);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(226, 232, 240, 0.5);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
            margin: 0 24px;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
            position: relative;
        }

        .stats::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.05) 0%, 
                rgba(118, 75, 162, 0.05) 50%, 
                rgba(16, 185, 129, 0.05) 100%);
            border-radius: 20px;
            pointer-events: none;
        }

        .stat-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 28px 24px;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #2563eb 0%, #10b981 50%, #f59e0b 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 40px rgba(0,0,0,0.15);
            background: rgba(255, 255, 255, 0.95);
        }

        .stat-item:hover::before {
            opacity: 1;
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 800;
            color: #1e293b;
            display: block;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .filters {
            padding: 20px 24px;
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.95) 0%, rgba(241, 245, 249, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
            border-radius: 16px;
            margin: 16px 24px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.1);
        }

        .filters-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 0;
            color: #1e293b;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .filters-toggle {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .filters-toggle:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .filters-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-size: 13px;
            font-weight: 700;
            color: #374151;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-select {
            padding: 12px 16px;
            border: 2px solid rgba(226, 232, 240, 0.5);
            border-radius: 10px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            min-width: 140px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .filter-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 4px 12px rgba(59, 130, 246, 0.2);
            background: rgba(255, 255, 255, 1);
        }

        .filter-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            padding-top: 20px;
            border-top: 2px solid rgba(59, 130, 246, 0.1);
        }

        .filter-actions-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .export-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            border: 2px solid rgba(16, 185, 129, 0.2);
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .export-btn.pdf {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            border-color: rgba(239, 68, 68, 0.2);
        }

        .export-btn.pdf:hover {
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }

        .export-btn.excel {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .export-btn.csv {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            border-color: rgba(139, 92, 246, 0.2);
        }

        .export-btn.print {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
            border-color: rgba(245, 158, 11, 0.2);
        }

        .clear-btn {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
            border: 2px solid rgba(107, 114, 128, 0.2);
        }

        .clear-btn:hover {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(107, 114, 128, 0.4);
        }

        .sort-indicator {
            margin-left: 5px;
            font-size: 12px;
            opacity: 0.7;
        }

        .sort-indicator.active {
            opacity: 1;
            color: #667eea;
        }

        th {
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s ease;
        }

        th:hover {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
        }

        .analytics-page {
            display: none;
            padding: 20px;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.02) 0%, rgba(30, 41, 59, 0.02) 100%);
            min-height: 100vh;
        }

        .analytics-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            border-radius: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            backdrop-filter: blur(10px);
        }

        .analytics-header h2 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #2563eb 0%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 15px 0;
            font-weight: 800;
        }

        .analytics-header p {
            color: #64748b;
            font-size: 1.2rem;
            font-weight: 500;
            margin: 0;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .analytics-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(226, 232, 240, 0.5);
            backdrop-filter: blur(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .analytics-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2563eb 0%, #10b981 50%, #f59e0b 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .analytics-card:hover {
            transform: translateY(-8px);
            box-shadow: 
                0 20px 48px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .analytics-card:hover::before {
            opacity: 1;
        }

        .analytics-card h3 {
            margin: 0 0 25px 0;
            color: #1e293b;
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(226, 232, 240, 0.5);
        }

        .chart-container {
            height: 280px;
            display: flex;
            align-items: end;
            justify-content: space-around;
            border-bottom: 3px solid rgba(59, 130, 246, 0.2);
            border-left: 3px solid rgba(59, 130, 246, 0.2);
            padding: 25px 15px 15px 15px;
            position: relative;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.02) 0%, rgba(16, 185, 129, 0.02) 100%);
            border-radius: 12px;
            margin: 10px 0;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent 0%, rgba(59, 130, 246, 0.3) 50%, transparent 100%);
        }

        .chart-bar {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 50%, #10b981 100%);
            border-radius: 8px 8px 0 0;
            min-width: 35px;
            max-width: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
            flex: 1;
            margin: 0 2px;
        }

        .chart-bar:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 12px 32px rgba(37, 99, 235, 0.4);
            background: linear-gradient(135deg, #1d4ed8 0%, #2563eb 50%, #059669 100%);
        }

        .chart-label {
            font-size: 13px;
            color: #1e293b;
            margin-top: 12px;
            text-align: center;
            font-weight: 700;
            line-height: 1.3;
            max-width: 90px;
            word-wrap: break-word;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid rgba(226, 232, 240, 0.5);
            backdrop-filter: blur(5px);
        }

        .chart-value {
            position: absolute;
            top: -45px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: 800;
            color: #0f172a;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%);
            padding: 6px 10px;
            border-radius: 8px;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(59, 130, 246, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(59, 130, 246, 0.3);
            backdrop-filter: blur(10px);
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            z-index: 10;
            min-width: 60px;
            text-align: center;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .chart-bar:hover .chart-value {
            opacity: 1;
            top: -50px;
        }

        .metric-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #6b7280;
            font-size: 14px;
        }

        .metric-value {
            font-weight: 600;
            color: #374151;
            font-size: 16px;
        }

        .trend-indicator {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 12px;
            margin-left: 8px;
        }

        .trend-up {
            background: #dcfce7;
            color: #166534;
        }

        .trend-down {
            background: #fef2f2;
            color: #991b1b;
        }

        .pie-chart {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            margin: 0 auto 25px;
            position: relative;
            box-shadow: 
                0 12px 32px rgba(37, 99, 235, 0.2),
                0 0 0 8px rgba(255, 255, 255, 0.8),
                0 0 0 12px rgba(59, 130, 246, 0.1);
            transition: all 0.4s ease;
        }

        .pie-chart:hover {
            transform: scale(1.05);
            box-shadow: 
                0 16px 48px rgba(37, 99, 235, 0.3),
                0 0 0 8px rgba(255, 255, 255, 0.9),
                0 0 0 16px rgba(59, 130, 246, 0.15);
        }

        .pie-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            justify-content: center;
            padding: 15px;
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.8) 100%);
            border-radius: 12px;
            border: 1px solid rgba(226, 232, 240, 0.5);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 1px solid rgba(226, 232, 240, 0.3);
        }

        .legend-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.9);
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* KPI Grid Styles */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 10px 0;
        }

        .kpi-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .kpi-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.15);
            border-color: #2563eb;
        }

        .kpi-icon {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            border-radius: 50%;
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .kpi-content {
            flex: 1;
        }

        .kpi-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 4px;
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .kpi-label {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Status Grid Styles */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 10px 0;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px;
            border-radius: 12px;
            border: 2px solid;
            transition: all 0.3s ease;
        }

        .status-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .status-high {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #22c55e;
        }

        .status-medium {
            background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%);
            border-color: #eab308;
        }

        .status-low {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-color: #f97316;
        }

        .status-empty {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            border-color: #ef4444;
        }

        .status-icon {
            font-size: 1.5rem;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .status-content {
            flex: 1;
        }

        .status-value {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .status-high .status-value {
            color: #166534;
        }

        .status-medium .status-value {
            color: #a16207;
        }

        .status-low .status-value {
            color: #c2410c;
        }

        .status-empty .status-value {
            color: #dc2626;
        }

        .status-label {
            font-size: 0.8rem;
            font-weight: 600;
            opacity: 0.8;
        }

        /* Distribution Chart Styles */
        .distribution-chart {
            height: 250px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px 10px;
        }

        .distribution-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
        }

        .distribution-label {
            min-width: 80px;
            font-size: 12px;
            font-weight: 600;
            color: #374151;
        }

        .distribution-bar-container {
            flex: 1;
            height: 25px;
            background: #f1f5f9;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .distribution-bar-fill {
            height: 100%;
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            border-radius: 12px;
            transition: width 0.8s ease;
            position: relative;
        }

        .distribution-value {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 11px;
            font-weight: 600;
            color: #374151;
        }

        /* Quarantine Card Hover Effects */
        .quarantine-stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.2);
        }

        /* Mobile Responsive for new components */
        @media (max-width: 768px) {
            .kpi-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .kpi-item {
                padding: 16px;
                gap: 12px;
            }

            .kpi-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }

            .kpi-value {
                font-size: 1.25rem;
            }

            .status-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .status-item {
                padding: 14px;
                gap: 10px;
            }

            .status-icon {
                width: 40px;
                height: 40px;
                font-size: 1.25rem;
            }

            .distribution-chart {
                height: 200px;
                padding: 15px 5px;
            }

            .distribution-bar {
                gap: 10px;
                padding: 8px 0;
            }

            .distribution-label {
                min-width: 60px;
                font-size: 11px;
            }

            .distribution-bar-container {
                height: 20px;
            }
        }

        .top-items {
            max-height: 350px;
            overflow-y: auto;
            padding: 5px;
        }

        .top-items::-webkit-scrollbar {
            width: 6px;
        }

        .top-items::-webkit-scrollbar-track {
            background: rgba(226, 232, 240, 0.3);
            border-radius: 3px;
        }

        .top-items::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #2563eb 0%, #10b981 100%);
            border-radius: 3px;
        }

        .top-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.8) 0%, rgba(241, 245, 249, 0.8) 100%);
            border-radius: 12px;
            border-left: 5px solid #2563eb;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.3);
        }

        .top-item:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.15);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
            border-left-color: #10b981;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 700;
            color: #1e293b;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .item-details {
            font-size: 13px;
            color: #64748b;
            margin-top: 4px;
            line-height: 1.4;
        }

        .item-value {
            font-weight: 800;
            background: linear-gradient(135deg, #2563eb 0%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 18px;
            text-align: right;
            min-width: 80px;
        }

        .nav-tabs {
            display: flex;
            gap: 0;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(51, 65, 85, 0.9) 100%);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            position: relative;
            backdrop-filter: blur(20px);
        }

        .nav-tabs::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(59, 130, 246, 0.3) 25%,
                rgba(16, 185, 129, 0.2) 50%,
                rgba(168, 85, 247, 0.2) 75%,
                transparent 100%);
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            padding: 20px 32px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 15px;
            font-weight: 700;
            color: #94a3b8;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            min-width: 160px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .nav-tab:hover::before {
            left: 100%;
        }

        .nav-tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.9) 100%);
            box-shadow: 
                0 -4px 16px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(148, 163, 184, 0.1);
            transform: translateY(-2px);
        }

        .nav-tab:hover:not(.active) {
            color: #cbd5e1;
            background: rgba(15, 23, 42, 0.8);
            transform: translateY(-1px);
        }

        .alert-badge {
            background: #dc2626;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
            font-weight: 600;
        }

        .pagination {
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            background: white;
            margin: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .pagination button {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
        }

        .pagination button:hover:not(:disabled) {
            background: #f8fafc;
            border-color: #2563eb;
            color: #2563eb;
            transform: translateY(-1px);
        }

        .pagination button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .pagination .active {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            border-color: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        .page-info {
            margin: 0 16px;
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }

        .view-buttons {
            display: flex;
            gap: 4px;
            background: #f1f5f9;
            padding: 4px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .view-btn {
            padding: 10px 16px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #64748b;
        }

        .view-btn.active {
            background: white;
            color: #2563eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .view-btn:hover:not(.active) {
            color: #374151;
            background: rgba(255,255,255,0.7);
        }

        /* Mobile-First Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 0;
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
                font-size: 14px;
            }
            
            .container {
                margin: 0;
                border-radius: 0;
                box-shadow: none;
                min-height: 100vh;
                background: rgba(15, 23, 42, 0.98);
                border: none;
            }
            
            .header {
                padding: 20px 16px;
                position: sticky;
                top: 0;
                z-index: 100;
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
                box-shadow: 
                    0 8px 32px rgba(0, 0, 0, 0.4),
                    inset 0 1px 0 rgba(148, 163, 184, 0.1);
            }
            
            .header h1 {
                font-size: 1.5rem;
                margin-bottom: 8px;
                line-height: 1.3;
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            
            .header p {
                font-size: 0.9rem;
                opacity: 0.9;
                color: #cbd5e1;
            }
            
            .header-content > div {
                flex-direction: column;
                gap: 12px;
            }
            
            #recordInfo, #lastModified {
                font-size: 0.8rem !important;
                color: #94a3b8 !important;
            }
            
            .nav-tabs {
                padding: 0;
                background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(51, 65, 85, 0.95) 100%);
                border-bottom: 1px solid rgba(148, 163, 184, 0.2);
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
                backdrop-filter: blur(20px);
            }
            
            .nav-tab {
                padding: 16px 20px;
                font-size: 14px;
                min-width: 120px;
                font-weight: 600;
                border-radius: 0;
                color: #94a3b8;
            }
            
            .nav-tab.active {
                background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.9) 100%);
                color: #3b82f6;
                border-bottom: 3px solid #3b82f6;
                box-shadow: inset 0 1px 0 rgba(148, 163, 184, 0.1);
            }
            
            .controls {
                padding: 16px;
                flex-direction: column;
                gap: 12px;
                background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(51, 65, 85, 0.95) 100%);
                border-bottom: 1px solid rgba(148, 163, 184, 0.2);
                backdrop-filter: blur(20px);
            }
            
            .search-box {
                min-width: auto;
                order: 1;
            }
            
            .search-box input {
                font-size: 16px;
                padding: 16px 16px 16px 48px;
                border-radius: 12px;
                border: 2px solid rgba(148, 163, 184, 0.3);
                background: rgba(15, 23, 42, 0.8);
                color: #f8fafc;
                box-shadow: 
                    0 4px 12px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(148, 163, 184, 0.1);
            }
            
            .search-box input:focus {
                border-color: #3b82f6;
                box-shadow: 
                    0 0 0 3px rgba(59, 130, 246, 0.2),
                    0 8px 24px rgba(59, 130, 246, 0.3),
                    inset 0 1px 0 rgba(148, 163, 184, 0.2);
                background: rgba(15, 23, 42, 0.95);
            }
            
            .control-buttons {
                order: 2;
                justify-content: space-between;
                gap: 8px;
                flex-wrap: wrap;
            }
            
            .load-btn {
                padding: 16px 20px;
                font-size: 14px;
                flex: 1;
                min-width: 140px;
                border-radius: 12px;
                font-weight: 600;
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
                border: 2px solid rgba(59, 130, 246, 0.3);
                color: #f8fafc;
            }
            
            .modal-btn {
                padding: 16px 18px;
                font-size: 13px;
                flex: 1;
                min-width: 120px;
                border-radius: 12px;
                font-weight: 600;
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                border: 2px solid rgba(16, 185, 129, 0.3);
                color: #f8fafc;
            }
            
            .view-buttons {
                flex: 1;
                justify-content: center;
                background: rgba(15, 23, 42, 0.8);
                border-radius: 10px;
                padding: 4px;
                border: 1px solid rgba(148, 163, 184, 0.2);
            }
            
            .view-btn {
                flex: 1;
                padding: 12px 14px;
                font-size: 12px;
                font-weight: 600;
                border-radius: 8px;
                background: transparent;
                color: #94a3b8;
                border: none;
                transition: all 0.3s ease;
            }
            
            .view-btn.active {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                color: #f8fafc;
                box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
            }
            
            .filters {
                padding: 16px;
                flex-direction: column;
                gap: 12px;
                background: white;
                margin: 0;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .filter-select {
                width: 100%;
                padding: 14px;
                font-size: 16px;
                border-radius: 10px;
            }
            
            .stats {
                padding: 16px;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                margin: 16px;
                border-radius: 12px;
                background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(51, 65, 85, 0.9) 100%);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(148, 163, 184, 0.2);
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            }
            
            .stat-item {
                padding: 20px 16px;
                border-radius: 10px;
                background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.8) 100%);
                border: 1px solid rgba(148, 163, 184, 0.2);
                text-align: center;
                box-shadow: 
                    0 4px 12px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(148, 163, 184, 0.1);
                backdrop-filter: blur(10px);
            }
            
            .stat-item:hover {
                transform: translateY(-2px);
                box-shadow: 
                    0 8px 20px rgba(0, 0, 0, 0.3),
                    0 0 0 1px rgba(59, 130, 246, 0.3),
                    inset 0 1px 0 rgba(148, 163, 184, 0.2);
                border-color: rgba(59, 130, 246, 0.4);
            }
            
            .stat-value {
                font-size: 1.75rem;
                margin-bottom: 6px;
                font-weight: 800;
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.3));
            }
            
            .stat-label {
                font-size: 0.8rem;
                color: #94a3b8;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-weight: 600;
            }
            
            .table-container {
                max-height: 65vh;
                margin: 16px;
                border-radius: 12px;
                box-shadow: 
                    0 8px 24px rgba(0, 0, 0, 0.3),
                    0 0 0 1px rgba(148, 163, 184, 0.2);
                border: 1px solid rgba(148, 163, 184, 0.2);
                background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%);
                backdrop-filter: blur(20px);
            }
            
            table {
                font-size: 12px;
                background: transparent;
            }
            
            th {
                padding: 12px 8px;
                min-width: 80px;
                font-size: 11px;
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
                color: #f8fafc;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                border-bottom: 2px solid rgba(59, 130, 246, 0.3);
                box-shadow: inset 0 1px 0 rgba(148, 163, 184, 0.1);
            }
            
            td {
                padding: 12px 8px;
                min-width: 80px;
                border-bottom: 1px solid rgba(148, 163, 184, 0.1);
                color: #e2e8f0;
                background: rgba(15, 23, 42, 0.3);
            }
            
            tr:hover {
                background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(16, 185, 129, 0.1) 100%) !important;
                transform: none;
            }
            
            tr:nth-child(even) td {
                background: linear-gradient(135deg, rgba(30, 41, 59, 0.2) 0%, rgba(51, 65, 85, 0.2) 100%);
            }
            
            tr:nth-child(odd) td {
                background: linear-gradient(135deg, rgba(15, 23, 42, 0.1) 0%, rgba(30, 41, 59, 0.1) 100%);
            }
            
            tr:nth-child(even):hover td {
                background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(16, 185, 129, 0.15) 100%) !important;
            }
            
            tr:nth-child(odd):hover td {
                background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(16, 185, 129, 0.1) 100%) !important;
            }
            
            .cards-container {
                padding: 16px;
                background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.9) 100%);
                backdrop-filter: blur(20px);
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                max-height: 65vh;
                overflow-y: auto;
                padding: 4px;
            }
            
            .item-card {
                padding: 20px;
                border-radius: 12px;
                background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.8) 100%);
                border: 1px solid rgba(148, 163, 184, 0.2);
                box-shadow: 
                    0 4px 12px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(148, 163, 184, 0.1);
                transition: all 0.3s ease;
                backdrop-filter: blur(10px);
            }
            
            .item-card:hover {
                transform: translateY(-3px);
                box-shadow: 
                    0 8px 20px rgba(0, 0, 0, 0.3),
                    0 0 0 1px rgba(59, 130, 246, 0.3),
                    inset 0 1px 0 rgba(148, 163, 184, 0.2);
                border-color: rgba(59, 130, 246, 0.4);
            }
            
            .card-header {
                margin-bottom: 16px;
            }
            
            .card-title {
                font-size: 1.1rem;
                font-weight: 600;
                color: #f8fafc;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            }
            
            .card-brand {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                color: #f8fafc;
                padding: 4px 10px;
                border-radius: 8px;
                font-size: 12px;
                font-weight: 600;
                box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
            }
            
            .card-detail {
                padding: 8px 0;
                border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            }
            
            .card-detail-label {
                font-size: 13px;
                color: #94a3b8;
                font-weight: 500;
            }
            
            .card-detail-value {
                font-size: 14px;
                color: #e2e8f0;
                font-weight: 600;
            }
            
            .card-metrics {
                gap: 16px;
                margin-top: 16px;
            }
            
            .card-metric-value {
                font-size: 1.2rem;
                font-weight: 700;
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                filter: drop-shadow(0 1px 2px rgba(59, 130, 246, 0.3));
            }
            
            .card-metric-label {
                font-size: 12px;
                color: #94a3b8;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-weight: 600;
            }
            
            .pagination {
                padding: 16px;
                flex-wrap: wrap;
                gap: 8px;
                margin: 16px;
                background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(51, 65, 85, 0.9) 100%);
                border-radius: 12px;
                box-shadow: 
                    0 8px 24px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(148, 163, 184, 0.1);
                border: 1px solid rgba(148, 163, 184, 0.2);
                backdrop-filter: blur(20px);
            }
            
            .pagination button {
                padding: 12px 16px;
                font-size: 13px;
                border-radius: 8px;
                font-weight: 600;
                border: 2px solid rgba(148, 163, 184, 0.3);
                background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.8) 100%);
                color: #e2e8f0;
                transition: all 0.3s ease;
            }
            
            .pagination button:hover:not(:disabled) {
                background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.1) 100%);
                border-color: rgba(59, 130, 246, 0.5);
                color: #3b82f6;
                transform: translateY(-1px);
            }
            
            .pagination .active {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                color: #f8fafc;
                border-color: rgba(59, 130, 246, 0.5);
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            }
            
            .page-info {
                width: 100%;
                text-align: center;
                margin: 12px 0;
                order: 3;
                font-size: 14px;
                color: #94a3b8;
                font-weight: 500;
            }
            
            #pageSizeSelect {
                order: 2;
                padding: 12px 14px;
                font-size: 13px;
                border-radius: 8px;
                border: 2px solid rgba(148, 163, 184, 0.3);
                background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.8) 100%);
                color: #e2e8f0;
                font-weight: 500;
            }
            
            .analytics-page {
                padding: 16px;
                background: #f8fafc;
            }
            
            .analytics-header h2 {
                font-size: 1.75rem;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .analytics-card {
                padding: 20px;
                border-radius: 12px;
            }
            
            .chart-container {
                height: 180px;
                padding: 12px 4px 4px 4px;
            }
            
            .chart-bar {
                min-width: 24px;
            }
            
            .chart-label {
                font-size: 10px;
            }
            
            .chart-value {
                font-size: 11px;
            }
            
            .pie-chart {
                width: 140px;
                height: 140px;
            }
            
            .pie-legend {
                gap: 8px;
            }
            
            .legend-item {
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.375rem;
            }
            
            .header p {
                font-size: 0.8rem;
            }
            
            .nav-tab {
                padding: 12px 16px;
                font-size: 13px;
                min-width: 100px;
            }
            
            .controls {
                padding: 12px;
            }
            
            .search-box input {
                padding: 14px 14px 14px 44px;
                font-size: 16px;
            }
            
            .load-btn, .modal-btn {
                padding: 14px 18px;
                font-size: 14px;
            }
            
            .view-btn {
                padding: 10px 12px;
                font-size: 12px;
            }
            
            .stats {
                grid-template-columns: 1fr;
                gap: 10px;
                margin: 12px;
            }
            
            .stat-item {
                padding: 16px 14px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: left;
            }
            
            .stat-value {
                font-size: 1.5rem;
                margin-bottom: 0;
            }
            
            .stat-label {
                font-size: 0.75rem;
            }
            
            .table-container {
                margin: 12px;
            }
            
            table {
                font-size: 11px;
            }
            
            th, td {
                padding: 8px 4px;
                min-width: 70px;
            }
            
            .item-card {
                padding: 16px;
            }
            
            .card-title {
                font-size: 1rem;
            }
            
            .card-brand {
                font-size: 11px;
                padding: 3px 6px;
            }
            
            .card-metric-value {
                font-size: 1rem;
            }
            
            .card-metric-label {
                font-size: 11px;
            }
            
            .pagination {
                margin: 12px;
                padding: 12px;
            }
            
            .pagination button {
                padding: 10px 14px;
                font-size: 13px;
            }
            
            .analytics-card {
                padding: 16px;
            }
            
            .chart-container {
                height: 160px;
            }
            
            .analytics-header h2 {
                font-size: 1.5rem;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            border-radius: 16px;
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .modal-close:hover {
            background-color: rgba(255,255,255,0.2);
        }

        .modal-body {
            padding: 30px;
            max-height: calc(90vh - 80px);
            overflow-y: auto;
        }

        .modal-search {
            position: relative;
            margin-bottom: 25px;
        }

        .modal-search input {
            width: 100%;
            padding: 12px 16px 12px 45px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .modal-search input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modal-search .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
        }

        .view-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .view-btn {
            padding: 10px 20px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .view-btn:hover:not(.active) {
            border-color: #667eea;
            color: #667eea;
        }

        .modal-table-container {
            overflow-x: auto;
            max-height: 60vh;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .modal-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .modal-table th {
            background: #f8fafc;
            color: #374151;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-table td {
            padding: 12px;
            border-bottom: 1px solid #f1f5f9;
        }

        .modal-table tr:hover {
            background-color: #f8fafc;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .cards-container {
            padding: 16px 20px;
            background: #f8fafc;
        }

        .cards-container .cards-grid {
            max-height: 70vh;
            overflow-y: auto;
            padding: 4px;
        }

        .item-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 28px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .item-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #2563eb 0%, #10b981 50%, #f59e0b 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .item-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.08), transparent);
            transition: left 0.6s ease;
        }

        .item-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 48px rgba(0,0,0,0.2);
            border-color: rgba(102, 126, 234, 0.3);
            background: rgba(255, 255, 255, 0.98);
        }

        .item-card:hover::before {
            opacity: 1;
        }

        .item-card:hover::after {
            left: 100%;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin: 0;
        }

        .card-brand {
            background: #2563eb;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .card-details {
            margin-bottom: 20px;
        }

        .card-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .card-detail:last-child {
            border-bottom: none;
        }

        .card-detail-label {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }

        .card-detail-value {
            font-size: 14px;
            color: #374151;
            font-weight: 500;
        }

        .card-metrics {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        .card-metric {
            text-align: center;
            flex: 1;
        }

        .card-metric-value {
            display: block;
            font-size: 1.2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 4px;
        }

        .card-metric-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Detail Modal Styles */
        .detail-modal .modal-content {
            max-width: 800px;
        }

        .detail-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
        }

        .detail-icon {
            font-size: 3rem;
            background: #667eea;
            color: white;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .detail-title-section h3 {
            margin: 0 0 8px 0;
            font-size: 1.8rem;
            color: #374151;
            font-weight: 700;
        }

        .detail-subtitle {
            margin: 0;
            color: #6b7280;
            font-size: 1.1rem;
        }

        .detail-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }

        .detail-highlight h4 {
            margin: 0 0 10px 0;
            font-size: 1rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .detail-highlight .value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .detail-section {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .detail-section h4 {
            margin: 0 0 20px 0;
            font-size: 1.1rem;
            color: #374151;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .detail-field:last-child {
            border-bottom: none;
        }

        .detail-field-label {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }

        .detail-field-value {
            font-size: 14px;
            color: #374151;
            font-weight: 600;
            text-align: right;
        }

        /* Mobile Modal Styles */
        @media (max-width: 768px) {
            .modal-content {
                margin: 5% auto;
                width: 98%;
                max-height: 95vh;
            }

            .modal-header {
                padding: 15px 20px;
            }

            .modal-header h2 {
                font-size: 1.3rem;
            }

            .modal-body {
                padding: 20px;
            }

            .cards-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .item-card {
                padding: 15px;
            }

            .card-metrics {
                gap: 10px;
            }

            .detail-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
                padding: 20px;
            }

            .detail-icon {
                width: 60px;
                height: 60px;
                font-size: 2rem;
            }

            .detail-title-section h3 {
                font-size: 1.5rem;
            }

            .detail-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .detail-section {
                padding: 20px;
            }

            .detail-field {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .detail-field-value {
                text-align: left;
                font-size: 16px;
            }

            .modal-table-container {
                max-height: 50vh;
            }

            .modal-table {
                font-size: 12px;
            }

            .modal-table th,
            .modal-table td {
                padding: 8px 6px;
                min-width: 80px;
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                margin: 2% auto;
                width: 100%;
                border-radius: 0;
                max-height: 100vh;
            }

            .modal-header {
                padding: 12px 15px;
            }

            .modal-header h2 {
                font-size: 1.2rem;
            }

            .modal-body {
                padding: 15px;
            }

            .view-buttons {
                flex-direction: column;
                gap: 8px;
            }

            .view-btn {
                padding: 12px 16px;
                text-align: center;
            }

            .detail-highlight .value {
                font-size: 2rem;
            }

            .modal-table {
                font-size: 11px;
            }

            .modal-table th,
            .modal-table td {
                padding: 6px 4px;
                min-width: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1> Data Stok WKB</h1>
                <p>Real-time data by PPIC</p>
                <div style="display: flex; justify-content: center; align-items: center; gap: 24px; margin-top: 12px; flex-wrap: wrap;">
                    <span id="recordInfo" style="font-size: 0.9rem; opacity: 0.9; color: #e2e8f0;">Click "Load Data" to fetch records</span>
                    <span id="lastModified" style="font-size: 0.9rem; opacity: 0.9; color: #cbd5e1;"> Checking last update...</span>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showPage('data')"> Data View</button>
            <button class="nav-tab" onclick="showPage('analytics')"> Analytics</button>
            <button class="nav-tab" onclick="showPage('quarantine')"> Karantina</button>
        </div>

        <div class="controls">
            <div class="search-box">
                <div class="search-icon"></div>
                <input type="text" id="searchInput" placeholder="Search by Product ID, Brand, Code, or any field...">
            </div>
            <div class="control-buttons">
                <button class="load-btn" id="loadBtn" onclick="loadData()">
                     Reload Data
                </button>
                <button class="view-btn active" onclick="switchDataView('table')" title="Table View">
                     Table
                </button>
                <button class="view-btn" onclick="switchDataView('cards')" title="Card View">
                     Cards
                </button>
                <button class="modal-btn" onclick="openTableModal()" title="Advanced Table View">
                     Advanced
                </button>
            </div>
        </div>

        <div class="filters" id="filters" style="display: none;">
            <div class="filters-header">
                <h4 class="filters-title">
                    Advanced Filters
                </h4>
                <button onclick="toggleFilters()" id="toggleFiltersBtn" class="filters-toggle">
                     Show Filters
                </button>
            </div>
            
            <div id="filtersContent" style="display: none;">
                <div class="filters-content">
                    <div class="filter-group">
                        <label class="filter-label"> Brand</label>
                        <select class="filter-select" id="brandFilter">
                            <option value="">All Brands</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label"> Size</label>
                        <select class="filter-select" id="sizeFilter">
                            <option value="">All Sizes</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label"> PO</label>
                        <select class="filter-select" id="poFilter">
                            <option value="">All PO</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label"> Packing</label>
                        <select class="filter-select" id="packingFilter">
                            <option value="">All Packing</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label"> Date Range</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="date" id="startDateFilter" class="filter-select" style="width: 140px;">
                            <input type="date" id="endDateFilter" class="filter-select" style="width: 140px;">
                        </div>
                    </div>

                </div>

                <div class="filter-actions">
                    <div class="filter-actions-group">
                        <button class="clear-btn" onclick="clearFilters()"> Clear All</button>
                    </div>
                    <div class="filter-actions-group">
                       
                        
                      <button class="export-btn print" onclick="printReport()"> Print</button>
                        
                              </div>
                </div>
            </div>
        </div>

        <div class="status" id="status">
            Click "Load Data" to fetch the latest inventory information
        </div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-item">
                <span class="stat-value" id="totalQty">0</span>
                <span class="stat-label">Current Saldo</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="totalKg">0</span>
                <span class="stat-label">Total Weight (KG)</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="uniqueBrands">0</span>
                <span class="stat-label">Unique Brands</span>
            </div>
        </div>



        <div class="table-container" id="tableContainer" style="display: none;">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th onclick="sortTable('PRODUK ID')">Product ID <span class="sort-indicator" id="sort-PRODUK ID"></span></th>
                        <th onclick="sortTable('SIZE')">Size <span class="sort-indicator" id="sort-SIZE"></span></th>
                        <th onclick="sortTable('PO')">PO <span class="sort-indicator" id="sort-PO"></span></th>
                        <th onclick="sortTable('JD')">JD <span class="sort-indicator" id="sort-JD"></span></th>
                        <th onclick="sortTable('KODE')">Code <span class="sort-indicator" id="sort-KODE"></span></th>
                        <th onclick="sortTable('KODE ASAL')">Code Asal <span class="sort-indicator" id="sort-KODE ASAL"></span></th>
                        <th onclick="sortTable('PACKING')">Packing <span class="sort-indicator" id="sort-PACKING"></span></th>
                        <th onclick="sortTable('BRAND')">Brand <span class="sort-indicator" id="sort-BRAND"></span></th>
                        <th onclick="sortTable('TGL MSK')">Tgl Masuk <span class="sort-indicator" id="sort-TGL MSK"></span></th>
                        <th onclick="sortTable('QTY MASUK')">Qty Masuk <span class="sort-indicator" id="sort-QTY MASUK"></span></th>
                        <th onclick="sortTable('OFFSET')">Offset <span class="sort-indicator" id="sort-OFFSET"></span></th>
                        <th onclick="sortTable('SALDO')">Saldo <span class="sort-indicator" id="sort-SALDO"></span></th>
                        <th onclick="sortTable('KG')">KG <span class="sort-indicator" id="sort-KG"></span></th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>

        <div class="cards-container" id="cardsContainer" style="display: none;">
            <div class="cards-grid" id="dataCardsGrid">
                <!-- Cards will be populated here -->
            </div>
        </div>

        <div class="pagination" id="pagination" style="display: none;">
            <button onclick="changePage(-1)" id="prevBtn"> Previous</button>
            <div class="page-info">
                <span id="pageInfo">Page 1 of 1</span>
            </div>
            <button onclick="changePage(1)" id="nextBtn">Next </button>
            <select id="pageSizeSelect" onchange="changePageSize()" style="margin-left: 20px; padding: 6px;">
                <option value="25">25 per page</option>
                <option value="50" selected>50 per page</option>
                <option value="100">100 per page</option>
                <option value="all">Show All</option>
            </select>
        </div>



        <div class="analytics-page" id="analyticsPage">
            <div class="analytics-header">
                <h2>Inventory Analytics</h2>
                <p>insights inventory data</p>
            </div>

            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3> Inventory by Brand</h3>
                    <div class="chart-container" id="brandChart">
                        <div style="text-align: center; color: #64748b; margin-top: 100px; padding: 40px 20px;">
                            <div style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></div>
                            <h4 style="margin: 0 0 8px 0; color: #374151; font-size: 1.1rem;">No Data Available</h4>
                            <p style="margin: 0; font-size: 0.9rem; color: #64748b;">Load data to view brand distribution</p>
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Top Products by Quantity</h3>
                    <div class="top-items" id="topProducts">
                        <div style="text-align: center; color: #64748b; padding: 50px 20px;">
                            <div style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></div>
                            <h4 style="margin: 0 0 8px 0; color: #374151; font-size: 1.1rem;">No Data Available</h4>
                            <p style="margin: 0; font-size: 0.9rem; color: #64748b;">Load data to view top products</p>
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Size Distribution</h3>
                    <div class="pie-chart" id="sizeChart" style="background: conic-gradient(#667eea 0deg 120deg, #764ba2 120deg 240deg, #f59e0b 240deg 360deg);">
                    </div>
                    <div class="pie-legend" id="sizeLegend">
                        <div style="text-align: center; color: #6b7280;">
                            Load data to view size distribution
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Daily Stock KG</h3>
                    <div class="chart-container" id="dailyKgChart">
                        <div style="text-align: center; color: #6b7280; margin-top: 100px;">
                            Load data to view daily KG trends
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Brand Performance</h3>
                    <div class="top-items" id="brandPerformance">
                        <div style="text-align: center; color: #6b7280; padding: 50px 0;">
                            Load data to view brand performance
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Packing Analysis</h3>
                    <div class="chart-container" id="packingChart">
                        <div style="text-align: center; color: #6b7280; margin-top: 100px;">
                            Load data to view packing distribution
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> PO Performance</h3>
                    <div class="top-items" id="poPerformance">
                        <div style="text-align: center; color: #6b7280; padding: 50px 0;">
                            Load data to view PO performance
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Monthly Trends</h3>
                    <div class="chart-container" id="monthlyTrendsChart">
                        <div style="text-align: center; color: #6b7280; margin-top: 100px;">
                            Load data to view monthly trends
                        </div>
                    </div>
                </div>





                <div class="analytics-card">
                    <h3> Top Performing Codes</h3>
                    <div class="top-items" id="topCodes">
                        <div style="text-align: center; color: #6b7280; padding: 50px 0;">
                            Load data to view top performing codes
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Inventory Distribution</h3>
                    <div class="distribution-chart" id="inventoryDistribution">
                        <div style="text-align: center; color: #6b7280; margin-top: 100px;">
                            Load data to view inventory distribution
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Weight Analysis by Brand</h3>
                    <div class="chart-container" id="weightByBrandChart">
                        <div style="text-align: center; color: #6b7280; margin-top: 100px;">
                            Load data to view weight analysis
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Top Products by Weight (KG)</h3>
                    <div class="top-items" id="topProductsByWeight">
                        <div style="text-align: center; color: #6b7280; padding: 50px 0;">
                            Load data to view heaviest products
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Weight Distribution Analysis</h3>
                    <div class="kpi-grid" style="grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                        <div class="kpi-item" style="background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%); border: 2px solid #93c5fd; border-radius: 12px; padding: 20px;">
                            <div class="kpi-icon" style="background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); width: 50px; height: 50px; font-size: 1.5rem;"></div>
                            <div class="kpi-content">
                                <div class="kpi-value" id="avgWeightPerItem" style="color: #2563eb; font-size: 2rem; font-weight: 800;">0</div>
                                <div class="kpi-label" style="color: #1d4ed8; font-size: 0.9rem; font-weight: 600;">Avg Weight/Item</div>
                                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 4px;">KG per product unit</div>
                            </div>
                        </div>
                        <div class="kpi-item" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 2px solid #86efac; border-radius: 12px; padding: 20px;">
                            <div class="kpi-icon" style="background: linear-gradient(135deg, #16a34a 0%, #15803d 100%); width: 50px; height: 50px; font-size: 1.5rem;"></div>
                            <div class="kpi-content">
                                <div class="kpi-value" id="weightEfficiency" style="color: #16a34a; font-size: 2rem; font-weight: 800;">0%</div>
                                <div class="kpi-label" style="color: #15803d; font-size: 0.9rem; font-weight: 600;">Weight Efficiency</div>
                                <div style="font-size: 0.8rem; color: #6b7280; margin-top: 4px;">KG to Quantity ratio</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="weight-metrics" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%); border-radius: 10px; border: 1px solid #fdba74;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: #ea580c;" id="heaviestProduct">-</div>
                            <div style="font-size: 0.8rem; color: #c2410c; font-weight: 600;">Heaviest Product</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%); border-radius: 10px; border: 1px solid #93c5fd;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: #2563eb;" id="totalWeightVariance">0</div>
                            <div style="font-size: 0.8rem; color: #1d4ed8; font-weight: 600;">Weight Variance</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%); border-radius: 10px; border: 1px solid #facc15;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: #ca8a04;" id="weightDensity">0</div>
                            <div style="font-size: 0.8rem; color: #a16207; font-weight: 600;">Density Index</div>
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Weight vs Quantity Correlation</h3>
                    <div class="chart-container" id="weightQuantityChart">
                        <div style="text-align: center; color: #6b7280; margin-top: 100px;">
                            Load data to view weight-quantity correlation
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3> Size vs Weight Analysis</h3>
                    <div class="top-items" id="sizeWeightAnalysis">
                        <div style="text-align: center; color: #6b7280; padding: 50px 0;">
                            Load data to view size-weight analysis
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="analytics-page" id="quarantinePage" style="display: none;">
            <div class="analytics-header">
                <h2> Karantina Management</h2>
                <p>Items in quarantine status </p>
            </div>

            <div class="quarantine-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; margin-bottom: 40px; padding: 0 10px;">
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border: 2px solid #fca5a5; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(220, 38, 38, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineTotal" style="color: #dc2626; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #991b1b; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Unique Products</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%); border: 2px solid #fdba74; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(234, 88, 12, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #ea580c 0%, #f97316 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineQty" style="color: #ea580c; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #c2410c; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Current Saldo</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fefce8 0%, #fde047 100%); border: 2px solid #facc15; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(202, 138, 4, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #ca8a04 0%, #eab308 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineWeight" style="color: #ca8a04; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #a16207; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Weight (KG)</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #f0f9ff 0%, #bfdbfe 100%); border: 2px solid #93c5fd; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(37, 99, 235, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #2563eb 0%, #3b82f6 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineQtyMasuk" style="color: #2563eb; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #1d4ed8; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Qty Masuk</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #bbf7d0 100%); border: 2px solid #86efac; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(22, 163, 74, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #16a34a 0%, #22c55e 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineOutgoing" style="color: #16a34a; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #15803d; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Keluar</span>
                </div>
            </div>

            <div class="quarantine-analytics" style="margin-bottom: 30px;">
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3> Karantina Flow Analysis</h3>
                        <div class="chart-container" id="quarantineFlowChart">
                            <div style="text-align: center; color: #6b7280; margin-top: 100px;">
                                Load data to view quarantine flow
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3> Top Karantina Products</h3>
                        <div class="top-items" id="topQuarantineProducts">
                            <div style="text-align: center; color: #6b7280; padding: 50px 0;">
                                Load data to view top quarantine products
                            </div>
                        </div>
                    </div>




                </div>
            </div>

            <div class="quarantine-controls" style="padding: 30px; background: linear-gradient(135deg, rgba(254, 242, 242, 0.95) 0%, rgba(254, 226, 226, 0.95) 100%); border-radius: 20px; margin-bottom: 35px; border: 2px solid rgba(252, 165, 165, 0.4); box-shadow: 0 12px 32px rgba(220, 38, 38, 0.15); backdrop-filter: blur(20px);">
                <div class="quarantine-controls-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid rgba(220, 38, 38, 0.2);">
                    <div style="font-size: 2rem;"></div>
                    <div>
                        <h3 style="margin: 0; color: #dc2626; font-size: 1.3rem; font-weight: 800;">Karantina Center</h3>
                        <p style="margin: 0; color: #991b1b; font-size: 0.9rem; font-weight: 500;">Advanced search and export </p>
                    </div>
                </div>
                
                <div class="quarantine-search-section" style="margin-bottom: 25px;">
                    <div class="search-box" style="position: relative; max-width: 600px;">
                        <div class="search-icon" style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: #dc2626; font-size: 18px; z-index: 2;"></div>
                        <input type="text" id="quarantineSearchInput" placeholder="Search: Product ID, Brand..." style="width: 100%; padding: 18px 20px 18px 60px; border: 2px solid rgba(220, 38, 38, 0.3); border-radius: 15px; font-size: 16px; background: rgba(255, 255, 255, 0.95); color: #1e293b; font-weight: 500; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1); transition: all 0.3s ease; backdrop-filter: blur(10px);">
                    </div>
                    <div class="search-suggestions" style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <span style="font-size: 12px; color: #991b1b; font-weight: 600;"> Search tips: Try searching by Product ID, Brand, Code, Size, PO, or Date</span>
                        <button onclick="document.getElementById('quarantineSearchInput').value=''; applyQuarantineFilters();" style="background: rgba(107, 114, 128, 0.1); color: #6b7280; border: 1px solid rgba(107, 114, 128, 0.3); padding: 4px 8px; border-radius: 6px; font-size: 11px; cursor: pointer; font-weight: 600;"> Clear</button>
                    </div>
                </div>
                
                <div class="quarantine-actions" style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                   
                    
                    <button onclick="printQuarantineReport()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 16px 28px; border-radius: 12px; font-weight: 700; box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3); transition: all 0.3s ease; border: 2px solid rgba(245, 158, 11, 0.2); font-size: 14px; cursor: pointer;">
                         Print Report
                    </button>
                    <div class="quarantine-stats-mini" style="margin-left: auto; display: flex; gap: 20px; align-items: center;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: 800; color: #dc2626;" id="quarantineSearchCount">0</div>
                            <div style="font-size: 0.8rem; color: #991b1b; font-weight: 600;">Found Items</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: 800; color: #ea580c;" id="quarantineSearchSaldo">0</div>
                            <div style="font-size: 0.8rem; color: #c2410c; font-weight: 600;">Total Saldo</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="quarantine-table-container" style="background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden;">
                <div class="table-container" id="quarantineTableContainer">
                    <table id="quarantineTable">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);">
                                <th style="color: white;">Product ID</th>
                                <th style="color: white;">Brand Status</th>
                                <th style="color: white;">Size</th>
                                <th style="color: white;">Code</th>
                                <th style="color: white;">Code Asal</th>
                                <th style="color: white;">Qty Masuk</th>
                                <th style="color: white;">Saldo</th>
                                <th style="color: white;">KG</th>
                                <th style="color: white;">Date Masuk</th>
                                <th style="color: white;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="quarantineTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="quarantine-empty" id="quarantineEmpty" style="display: none; text-align: center; padding: 60px 20px; color: #6b7280;">
                <div style="font-size: 4rem; margin-bottom: 20px;"></div>
                <h3 style="margin: 0 0 10px 0; color: #374151;">No Items in Quarantine</h3>
                <p style="margin: 0;">All items are in good status!</p>
            </div>
        </div>
    </div>

    <!-- Table Modal -->
    <div id="tableModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2> Advanced Table View</h2>
                <button class="modal-close" onclick="closeModal('tableModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-search">
                    <div class="search-icon"></div>
                    <input type="text" id="modalSearchInput" placeholder="Search in modal...">
                </div>
                
                <div class="view-buttons">
                    <button class="view-btn active" onclick="switchModalView('table')"> Table</button>
                    <button class="view-btn" onclick="switchModalView('summary')"> Summary</button>
                </div>

                <div id="modalTableView">
                    <div class="modal-table-container">
                        <table class="modal-table" id="modalTable">
                            <thead>
                                <tr>
                                    <th>Product ID</th>
                                    <th>Brand</th>
                                    <th>Size</th>
                                    <th>Code</th>
                                    <th>Qty Masuk</th>
                                    <th>Saldo</th>
                                    <th>KG</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="modalTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="modalSummaryView" style="display: none;">
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h3> Quick Stats</h3>
                            <ul class="metric-list">
                                <li class="metric-item">
                                    <span class="metric-label">Total Items</span>
                                    <span class="metric-value" id="modalTotalItems">-</span>
                                </li>
                                <li class="metric-item">
                                    <span class="metric-label">Total Quantity</span>
                                    <span class="metric-value" id="modalTotalQty">-</span>
                                </li>
                                <li class="metric-item">
                                    <span class="metric-label">Total Weight</span>
                                    <span class="metric-value" id="modalTotalWeight">-</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="analytics-page" id="quarantinePage" style="display: none;">
            <div class="analytics-header">
                <h2> Karantina Management</h2>
                <p>Items in quarantine status - requires special attention</p>
            </div>

            <div class="quarantine-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; margin-bottom: 40px; padding: 0 10px;">
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border: 2px solid #fca5a5; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(220, 38, 38, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineTotal" style="color: #dc2626; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #991b1b; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Unique Products</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%); border: 2px solid #fdba74; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(234, 88, 12, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #ea580c 0%, #f97316 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineQty" style="color: #ea580c; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #c2410c; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Current Saldo</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fefce8 0%, #fde047 100%); border: 2px solid #facc15; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(202, 138, 4, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #ca8a04 0%, #eab308 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineWeight" style="color: #ca8a04; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #a16207; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Weight (KG)</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #f0f9ff 0%, #bfdbfe 100%); border: 2px solid #93c5fd; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(37, 99, 235, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #2563eb 0%, #3b82f6 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineQtyMasuk" style="color: #2563eb; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #1d4ed8; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Qty Masuk</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #bbf7d0 100%); border: 2px solid #86efac; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(22, 163, 74, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #16a34a 0%, #22c55e 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineOutgoing" style="color: #16a34a; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #15803d; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Keluar</span>
                </div>
            </div>

            <div class="quarantine-analytics" style="margin-bottom: 30px;">
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3> Karantina Flow Analysis</h3>
                        <div class="chart-container" id="quarantineFlowChart">
                            <div style="text-align: center; color: #6b7280; margin-top: 100px;">
                                Load data to view quarantine flow
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3> Top Karantina Products</h3>
                        <div class="top-items" id="topQuarantineProducts">
                            <div style="text-align: center; color: #6b7280; padding: 50px 0;">
                                Load data to view top quarantine products
                            </div>
                        </div>
                    </div>




                </div>
            </div>

            <div class="quarantine-controls" style="padding: 30px; background: linear-gradient(135deg, rgba(254, 242, 242, 0.95) 0%, rgba(254, 226, 226, 0.95) 100%); border-radius: 20px; margin-bottom: 35px; border: 2px solid rgba(252, 165, 165, 0.4); box-shadow: 0 12px 32px rgba(220, 38, 38, 0.15); backdrop-filter: blur(20px);">
                <div class="quarantine-controls-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid rgba(220, 38, 38, 0.2);">
                    <div style="font-size: 2rem;"></div>
                    <div>
                        <h3 style="margin: 0; color: #dc2626; font-size: 1.3rem; font-weight: 800;">Karantina Management Center</h3>
                        <p style="margin: 0; color: #991b1b; font-size: 0.9rem; font-weight: 500;">Advanced search and export tools for quarantine items</p>
                    </div>
                </div>
                
                <div class="quarantine-search-section" style="margin-bottom: 25px;">
                    <div class="search-box" style="position: relative; max-width: 600px;">
                        <div class="search-icon" style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: #dc2626; font-size: 18px; z-index: 2;"></div>
                        <input type="text" id="quarantineSearchInput" placeholder=" Search: Product ID, Brand, Code, Size, PO, Date..." style="width: 100%; padding: 18px 20px 18px 60px; border: 2px solid rgba(220, 38, 38, 0.3); border-radius: 15px; font-size: 16px; background: rgba(255, 255, 255, 0.95); color: #1e293b; font-weight: 500; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1); transition: all 0.3s ease; backdrop-filter: blur(10px);">
                    </div>
                    <div class="search-suggestions" style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <span style="font-size: 12px; color: #991b1b; font-weight: 600;"> Search tips: Try searching by Product ID, Brand, Code, Size, PO, or Date</span>
                        <button onclick="document.getElementById('quarantineSearchInput').value=''; applyQuarantineFilters();" style="background: rgba(107, 114, 128, 0.1); color: #6b7280; border: 1px solid rgba(107, 114, 128, 0.3); padding: 4px 8px; border-radius: 6px; font-size: 11px; cursor: pointer; font-weight: 600;"> Clear</button>
                    </div>
                </div>
                
                <div class="quarantine-actions" style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <button class="export-btn" onclick="exportQuarantineReport()" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); padding: 16px 28px; border-radius: 12px; font-weight: 700; box-shadow: 0 6px 20px rgba(220, 38, 38, 0.3); transition: all 0.3s ease; border: 2px solid rgba(220, 38, 38, 0.2); font-size: 14px;">
                         Export Karantina Report
                    </button>
                    <button onclick="printQuarantineReport()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 16px 28px; border-radius: 12px; font-weight: 700; box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3); transition: all 0.3s ease; border: 2px solid rgba(245, 158, 11, 0.2); font-size: 14px; cursor: pointer;">
                         Print Report
                    </button>
                    <div class="quarantine-stats-mini" style="margin-left: auto; display: flex; gap: 20px; align-items: center;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: 800; color: #dc2626;" id="quarantineSearchCount">0</div>
                            <div style="font-size: 0.8rem; color: #991b1b; font-weight: 600;">Found Items</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: 800; color: #ea580c;" id="quarantineSearchSaldo">0</div>
                            <div style="font-size: 0.8rem; color: #c2410c; font-weight: 600;">Total Saldo</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="quarantine-table-container" style="background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden;">
                <div class="table-container" id="quarantineTableContainer">
                    <table id="quarantineTable">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);">
                                <th style="color: white;">Product ID</th>
                                <th style="color: white;">Brand Status</th>
                                <th style="color: white;">Size</th>
                                <th style="color: white;">Code</th>
                                <th style="color: white;">Code Asal</th>
                                <th style="color: white;">Qty Masuk</th>
                                <th style="color: white;">Saldo</th>
                                <th style="color: white;">KG</th>
                                <th style="color: white;">Date Masuk</th>
                                <th style="color: white;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="quarantineTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="quarantine-empty" id="quarantineEmpty" style="display: none; text-align: center; padding: 60px 20px; color: #6b7280;">
                <div style="font-size: 4rem; margin-bottom: 20px;"></div>
                <h3 style="margin: 0 0 10px 0; color: #374151;">No Items in Quarantine</h3>
                <p style="margin: 0;">All items are in good status!</p>
            </div>
        </div>
    </div>

    <!-- Card Modal -->
    <div id="cardModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2> Card View</h2>
                <button class="modal-close" onclick="closeModal('cardModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-search">
                    <div class="search-icon"></div>
                    <input type="text" id="cardModalSearchInput" placeholder="Search cards...">
                </div>
                
                <div class="cards-grid" id="cardsContainer">
                    <!-- Cards will be populated here -->
                </div>
            </div>
        </div>

        <div class="analytics-page" id="quarantinePage" style="display: none;">
            <div class="analytics-header">
                <h2> Karantina Management</h2>
                <p>Items in quarantine status - requires special attention</p>
            </div>

            <div class="quarantine-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; margin-bottom: 40px; padding: 0 10px;">
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border: 2px solid #fca5a5; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(220, 38, 38, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineTotal" style="color: #dc2626; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #991b1b; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Unique Products</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%); border: 2px solid #fdba74; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(234, 88, 12, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #ea580c 0%, #f97316 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineQty" style="color: #ea580c; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #c2410c; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Current Saldo</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fefce8 0%, #fde047 100%); border: 2px solid #facc15; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(202, 138, 4, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #ca8a04 0%, #eab308 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineWeight" style="color: #ca8a04; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #a16207; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Weight (KG)</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #f0f9ff 0%, #bfdbfe 100%); border: 2px solid #93c5fd; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(37, 99, 235, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #2563eb 0%, #3b82f6 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineQtyMasuk" style="color: #2563eb; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #1d4ed8; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Qty Masuk</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #bbf7d0 100%); border: 2px solid #86efac; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(22, 163, 74, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #16a34a 0%, #22c55e 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineOutgoing" style="color: #16a34a; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #15803d; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Keluar</span>
                </div>
            </div>

            <div class="quarantine-analytics" style="margin-bottom: 30px;">
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3> Karantina Flow Analysis</h3>
                        <div class="chart-container" id="quarantineFlowChart">
                            <div style="text-align: center; color: #6b7280; margin-top: 100px;">
                                Load data to view quarantine flow
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3> Top Karantina Products</h3>
                        <div class="top-items" id="topQuarantineProducts">
                            <div style="text-align: center; color: #6b7280; padding: 50px 0;">
                                Load data to view top quarantine products
                            </div>
                        </div>
                    </div>




                </div>
            </div>

            <div class="quarantine-controls" style="padding: 30px; background: linear-gradient(135deg, rgba(254, 242, 242, 0.95) 0%, rgba(254, 226, 226, 0.95) 100%); border-radius: 20px; margin-bottom: 35px; border: 2px solid rgba(252, 165, 165, 0.4); box-shadow: 0 12px 32px rgba(220, 38, 38, 0.15); backdrop-filter: blur(20px);">
                <div class="quarantine-controls-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid rgba(220, 38, 38, 0.2);">
                    <div style="font-size: 2rem;"></div>
                    <div>
                        <h3 style="margin: 0; color: #dc2626; font-size: 1.3rem; font-weight: 800;">Karantina Management Center</h3>
                        <p style="margin: 0; color: #991b1b; font-size: 0.9rem; font-weight: 500;">Advanced search and export tools for quarantine items</p>
                    </div>
                </div>
                
                <div class="quarantine-search-section" style="margin-bottom: 25px;">
                    <div class="search-box" style="position: relative; max-width: 600px;">
                        <div class="search-icon" style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: #dc2626; font-size: 18px; z-index: 2;"></div>
                        <input type="text" id="quarantineSearchInput" placeholder=" Search: Product ID, Brand, Code, Size, PO, Date..." style="width: 100%; padding: 18px 20px 18px 60px; border: 2px solid rgba(220, 38, 38, 0.3); border-radius: 15px; font-size: 16px; background: rgba(255, 255, 255, 0.95); color: #1e293b; font-weight: 500; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1); transition: all 0.3s ease; backdrop-filter: blur(10px);">
                    </div>
                    <div class="search-suggestions" style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <span style="font-size: 12px; color: #991b1b; font-weight: 600;"> Search tips: Try searching by Product ID, Brand, Code, Size, PO, or Date</span>
                        <button onclick="document.getElementById('quarantineSearchInput').value=''; applyQuarantineFilters();" style="background: rgba(107, 114, 128, 0.1); color: #6b7280; border: 1px solid rgba(107, 114, 128, 0.3); padding: 4px 8px; border-radius: 6px; font-size: 11px; cursor: pointer; font-weight: 600;"> Clear</button>
                    </div>
                </div>
                
                <div class="quarantine-actions" style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <button class="export-btn" onclick="exportQuarantineReport()" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); padding: 16px 28px; border-radius: 12px; font-weight: 700; box-shadow: 0 6px 20px rgba(220, 38, 38, 0.3); transition: all 0.3s ease; border: 2px solid rgba(220, 38, 38, 0.2); font-size: 14px;">
                         Export Karantina Report
                    </button>
                    <button onclick="printQuarantineReport()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 16px 28px; border-radius: 12px; font-weight: 700; box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3); transition: all 0.3s ease; border: 2px solid rgba(245, 158, 11, 0.2); font-size: 14px; cursor: pointer;">
                         Print Report
                    </button>
                    <div class="quarantine-stats-mini" style="margin-left: auto; display: flex; gap: 20px; align-items: center;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: 800; color: #dc2626;" id="quarantineSearchCount">0</div>
                            <div style="font-size: 0.8rem; color: #991b1b; font-weight: 600;">Found Items</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: 800; color: #ea580c;" id="quarantineSearchSaldo">0</div>
                            <div style="font-size: 0.8rem; color: #c2410c; font-weight: 600;">Total Saldo</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="quarantine-table-container" style="background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden;">
                <div class="table-container" id="quarantineTableContainer">
                    <table id="quarantineTable">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);">
                                <th style="color: white;">Product ID</th>
                                <th style="color: white;">Brand Status</th>
                                <th style="color: white;">Size</th>
                                <th style="color: white;">Code</th>
                                <th style="color: white;">Code Asal</th>
                                <th style="color: white;">Qty Masuk</th>
                                <th style="color: white;">Saldo</th>
                                <th style="color: white;">KG</th>
                                <th style="color: white;">Date Masuk</th>
                                <th style="color: white;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="quarantineTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="quarantine-empty" id="quarantineEmpty" style="display: none; text-align: center; padding: 60px 20px; color: #6b7280;">
                <div style="font-size: 4rem; margin-bottom: 20px;"></div>
                <h3 style="margin: 0 0 10px 0; color: #374151;">No Items in Quarantine</h3>
                <p style="margin: 0;">All items are in good status!</p>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2> Item Details</h2>
                <button class="modal-close" onclick="closeModal('detailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-header">
                    <div class="detail-icon"></div>
                    <div class="detail-title-section">
                        <h3 id="detailTitle">Product Details</h3>
                        <p class="detail-subtitle" id="detailSubtitle">Complete information</p>
                    </div>
                </div>

                <div class="detail-highlight">
                    <h4>Current Stock Level</h4>
                    <p class="value" id="detailSaldo">-</p>
                </div>

                <div class="detail-grid">
                    <div class="detail-section">
                        <h4> Product Information</h4>
                        <div class="detail-field">
                            <span class="detail-field-label">Product ID</span>
                            <span class="detail-field-value" id="detailProductId">-</span>
                        </div>
                        <div class="detail-field">
                            <span class="detail-field-label">Brand</span>
                            <span class="detail-field-value" id="detailBrand">-</span>
                        </div>
                        <div class="detail-field">
                            <span class="detail-field-label">Size</span>
                            <span class="detail-field-value" id="detailSize">-</span>
                        </div>
                        <div class="detail-field">
                            <span class="detail-field-label">Code</span>
                            <span class="detail-field-value" id="detailCode">-</span>
                        </div>
                        <div class="detail-field">
                            <span class="detail-field-label">Code Asal</span>
                            <span class="detail-field-value" id="detailCodeAsal">-</span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4> Details</h4>
                        <div class="detail-field">
                            <span class="detail-field-label">Quantity Masuk</span>
                            <span class="detail-field-value" id="detailQtyMasuk">-</span>
                        </div>
                        <div class="detail-field">
                            <span class="detail-field-label">Offset</span>
                            <span class="detail-field-value" id="detailOffset">-</span>
                        </div>
                        <div class="detail-field">
                            <span class="detail-field-label">Weight (KG)</span>
                            <span class="detail-field-value" id="detailKg">-</span>
                        </div>
                        <div class="detail-field">
                            <span class="detail-field-label">Packing</span>
                            <span class="detail-field-value" id="detailPacking">-</span>
                        </div>
                        <div class="detail-field">
                            <span class="detail-field-label">Date Masuk</span>
                            <span class="detail-field-value" id="detailTglMasuk">-</span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4> PO & Julian date</h4>
                        <div class="detail-field">
                            <span class="detail-field-label">PO</span>
                            <span class="detail-field-value" id="detailPo">-</span>
                        </div>
                        <div class="detail-field">
                            <span class="detail-field-label">JD</span>
                            <span class="detail-field-value" id="detailJd">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="analytics-page" id="quarantinePage" style="display: none;">
            <div class="analytics-header">
                <h2> Karantina Management</h2>
                <p>Items in quarantine status - requires special attention</p>
            </div>

            <div class="quarantine-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; margin-bottom: 40px; padding: 0 10px;">
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border: 2px solid #fca5a5; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(220, 38, 38, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #dc2626 0%, #ef4444 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineTotal" style="color: #dc2626; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #991b1b; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Unique Products</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%); border: 2px solid #fdba74; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(234, 88, 12, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #ea580c 0%, #f97316 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineQty" style="color: #ea580c; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #c2410c; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Current Saldo</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #fefce8 0%, #fde047 100%); border: 2px solid #facc15; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(202, 138, 4, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #ca8a04 0%, #eab308 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineWeight" style="color: #ca8a04; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #a16207; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Weight (KG)</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #f0f9ff 0%, #bfdbfe 100%); border: 2px solid #93c5fd; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(37, 99, 235, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #2563eb 0%, #3b82f6 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineQtyMasuk" style="color: #2563eb; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #1d4ed8; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Qty Masuk</span>
                </div>
                <div class="quarantine-stat-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #bbf7d0 100%); border: 2px solid #86efac; border-radius: 16px; padding: 25px; text-align: center; box-shadow: 0 8px 24px rgba(22, 163, 74, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #16a34a 0%, #22c55e 100%);"></div>
                    <div style="font-size: 2rem; margin-bottom: 8px;"></div>
                    <span class="stat-value" id="quarantineOutgoing" style="color: #16a34a; font-size: 2.5rem; font-weight: 800; display: block; margin-bottom: 8px;">0</span>
                    <span class="stat-label" style="color: #15803d; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Total Keluar</span>
                </div>
            </div>

            <div class="quarantine-analytics" style="margin-bottom: 30px;">
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3> Karantina Flow Analysis</h3>
                        <div class="chart-container" id="quarantineFlowChart">
                            <div style="text-align: center; color: #6b7280; margin-top: 100px;">
                                Load data to view quarantine flow
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3> Top Karantina Products</h3>
                        <div class="top-items" id="topQuarantineProducts">
                            <div style="text-align: center; color: #6b7280; padding: 50px 0;">
                                Load data to view top quarantine products
                            </div>
                        </div>
                    </div>




                </div>
            </div>

            <div class="quarantine-controls" style="padding: 30px; background: linear-gradient(135deg, rgba(254, 242, 242, 0.95) 0%, rgba(254, 226, 226, 0.95) 100%); border-radius: 20px; margin-bottom: 35px; border: 2px solid rgba(252, 165, 165, 0.4); box-shadow: 0 12px 32px rgba(220, 38, 38, 0.15); backdrop-filter: blur(20px);">
                <div class="quarantine-controls-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid rgba(220, 38, 38, 0.2);">
                    <div style="font-size: 2rem;"></div>
                    <div>
                        <h3 style="margin: 0; color: #dc2626; font-size: 1.3rem; font-weight: 800;">Karantina Management Center</h3>
                        <p style="margin: 0; color: #991b1b; font-size: 0.9rem; font-weight: 500;">Advanced search and export tools for quarantine items</p>
                    </div>
                </div>
                
                <div class="quarantine-search-section" style="margin-bottom: 25px;">
                    <div class="search-box" style="position: relative; max-width: 600px;">
                        <div class="search-icon" style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: #dc2626; font-size: 18px; z-index: 2;"></div>
                        <input type="text" id="quarantineSearchInput" placeholder=" Search: Product ID, Brand, Code, Size, PO, Date..." style="width: 100%; padding: 18px 20px 18px 60px; border: 2px solid rgba(220, 38, 38, 0.3); border-radius: 15px; font-size: 16px; background: rgba(255, 255, 255, 0.95); color: #1e293b; font-weight: 500; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1); transition: all 0.3s ease; backdrop-filter: blur(10px);">
                    </div>
                    <div class="search-suggestions" style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                        <span style="font-size: 12px; color: #991b1b; font-weight: 600;"> Search tips: Try searching by Product ID, Brand, Code, Size, PO, or Date</span>
                        <button onclick="document.getElementById('quarantineSearchInput').value=''; applyQuarantineFilters();" style="background: rgba(107, 114, 128, 0.1); color: #6b7280; border: 1px solid rgba(107, 114, 128, 0.3); padding: 4px 8px; border-radius: 6px; font-size: 11px; cursor: pointer; font-weight: 600;"> Clear</button>
                    </div>
                </div>
                
                <div class="quarantine-actions" style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <button class="export-btn" onclick="exportQuarantineReport()" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); padding: 16px 28px; border-radius: 12px; font-weight: 700; box-shadow: 0 6px 20px rgba(220, 38, 38, 0.3); transition: all 0.3s ease; border: 2px solid rgba(220, 38, 38, 0.2); font-size: 14px;">
                         Export Karantina Report
                    </button>
                    <button onclick="printQuarantineReport()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 16px 28px; border-radius: 12px; font-weight: 700; box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3); transition: all 0.3s ease; border: 2px solid rgba(245, 158, 11, 0.2); font-size: 14px; cursor: pointer;">
                         Print Report
                    </button>
                    <div class="quarantine-stats-mini" style="margin-left: auto; display: flex; gap: 20px; align-items: center;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: 800; color: #dc2626;" id="quarantineSearchCount">0</div>
                            <div style="font-size: 0.8rem; color: #991b1b; font-weight: 600;">Found Items</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: 800; color: #ea580c;" id="quarantineSearchSaldo">0</div>
                            <div style="font-size: 0.8rem; color: #c2410c; font-weight: 600;">Total Saldo</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="quarantine-table-container" style="background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden;">
                <div class="table-container" id="quarantineTableContainer">
                    <table id="quarantineTable">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);">
                                <th style="color: white;">Product ID</th>
                                <th style="color: white;">Brand Status</th>
                                <th style="color: white;">Size</th>
                                <th style="color: white;">Code</th>
                                <th style="color: white;">Code Asal</th>
                                <th style="color: white;">Qty Masuk</th>
                                <th style="color: white;">Saldo</th>
                                <th style="color: white;">KG</th>
                                <th style="color: white;">Date Masuk</th>
                                <th style="color: white;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="quarantineTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="quarantine-empty" id="quarantineEmpty" style="display: none; text-align: center; padding: 60px 20px; color: #6b7280;">
                <div style="font-size: 4rem; margin-bottom: 20px;"></div>
                <h3 style="margin: 0 0 10px 0; color: #374151;">No Items in Quarantine</h3>
                <p style="margin: 0;">All items are in good status!</p>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyBhiKDVDH4fle5_EqAIaA05YjpxVMEBYZM";
        const SHEET_ID = "1W8oJp2V8B0HCjTi8O4yA9r3Zh3kX7aRKSYEZ49XTHeQ";
        const SHEET_NAME = "DETAIL";
        
        // Get last modified time from Drive API
        async function getLastModified() {
            try {
                const url = `https://www.googleapis.com/drive/v3/files/${SHEET_ID}?fields=modifiedTime,name&key=${API_KEY}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const modifiedTime = new Date(data.modifiedTime);
                const now = new Date();
                const diffMinutes = Math.floor((now - modifiedTime) / (1000 * 60));
                
                let timeText;
                if (diffMinutes < 1) {
                    timeText = 'Just now';
                } else if (diffMinutes < 60) {
                    timeText = `${diffMinutes} minutes ago`;
                } else if (diffMinutes < 1440) {
                    const hours = Math.floor(diffMinutes / 60);
                    timeText = `${hours} hour${hours > 1 ? 's' : ''} ago`;
                } else {
                    const days = Math.floor(diffMinutes / 1440);
                    timeText = `${days} day${days > 1 ? 's' : ''} ago`;
                }
                
                document.getElementById('lastModified').innerHTML = ` Last updated: ${timeText}`;
                document.getElementById('lastModified').style.color = '#10b981';
                
            } catch (error) {
                console.error(' Error getting last modified time:', error);
                document.getElementById('lastModified').innerHTML = ' Update time unavailable';
                document.getElementById('lastModified').style.color = '#ef4444';
            }
        }

        // Validate API connection
        async function validateConnection() {
            try {
                const testUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}?key=${API_KEY}`;
                const response = await fetch(testUrl);
                
                if (!response.ok) {
                    throw new Error(`API connection failed: ${response.status}`);
                }
                
                console.log(' API connection validated successfully');
                return true;
            } catch (error) {
                console.error(' API validation failed:', error);
                return false;
            }
        }
        
        let allData = [];
        let filteredData = [];
        let quarantineData = [];
        let filteredQuarantineData = [];
        let currentPage = 1;
        let pageSize = 50;
        let sortColumn = '';
        let sortDirection = 'asc';

        // Column mapping - Updated for current sheet structure
        // Let's check the actual sheet structure first and map accordingly
        const COLUMNS = {
            'PRODUK ID': 4,    // Column E (PRODUK ID)
            'SIZE': 6,         // Column G (SIZE)  
            'PO': 7,           // Column H (PO)
            'JD': 8,           // Column I (JD)
            'KODE': 9,         // Column J (KODE)
            'KODE ASAL': 10,   // Column K (KODE ASAL)
            'PACKING': 11,     // Column L (PACKING)
            'BRAND': 12,       // Column M (BRAND)
            'TGL MSK': 14,     // Column O (TGL MSK)
            'QTY MASUK': 15,   // Column P (QTY MASUK)
            'OFFSET': 47,      // Column AV (OFFSET)
            'SALDO': 48,       // Column AW (SALDO)
            'KG': 52           // Column BA (KG)
        };

        async function loadData() {
            const loadBtn = document.getElementById('loadBtn');
            const status = document.getElementById('status');
            const tableContainer = document.getElementById('tableContainer');
            const statsElement = document.querySelector('.stats');

            loadBtn.disabled = true;
            loadBtn.innerHTML = '<div class="loading-spinner"></div>Loading Data...';
            status.className = 'status loading';
            status.textContent = ' Loading inventory data...';

            try {
                // Optimized data fetching with specific range
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}!A:BZ?key=${API_KEY}`;
                const response = await fetch(url);
                
                
                if (!response.ok) {
                    throw new Error(`Failed to load data: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.values || data.values.length === 0) {
                    throw new Error('No data found in spreadsheet');
                }

                // Optimized column detection
                const headers = data.values[0] || [];
                const columnMappings = {
                    'PRODUK ID': ['PRODUK ID', 'PRODUCT ID'],
                    'SIZE': ['SIZE'],
                    'PO': ['PO'],
                    'JD': ['JD'],
                    'KODE': ['KODE'],
                    'KODE ASAL': ['KODE ASAL'],
                    'PACKING': ['PACKING'],
                    'BRAND': ['BRAND'],
                    'TGL MSK': ['TGL MSK', 'TGL MASUK'],
                    'QTY MASUK': ['QTY MASUK'],
                    'OFFSET': ['OFFSET'],
                    'SALDO': ['SALDO'],
                    'KG': ['KG']
                };

                // Fast column detection
                const detectedColumns = {};
                Object.keys(columnMappings).forEach(key => {
                    const possibleNames = columnMappings[key];
                    for (let i = 0; i < headers.length; i++) {
                        const header = String(headers[i] || '').toUpperCase().trim();
                        if (possibleNames.some(name => header === name || header.includes(name))) {
                            detectedColumns[key] = i;
                            break;
                        }
                    }
                });

                Object.assign(COLUMNS, detectedColumns);

                // Optimized data processing
                allData = processDataOptimized(data.values);
                filteredData = allData.slice(); // Faster than spread operator
                
                // Optimized quarantine filtering
                quarantineData = allData.filter(row => {
                    const brand = row['BRAND'];
                    return brand && (brand.toLowerCase().includes('karantina') || brand.toLowerCase().includes('quarantine'));
                });
                filteredQuarantineData = quarantineData.slice();
                
                // Batch DOM updates
                requestAnimationFrame(() => {
                    populateFilters();
                    displayData(filteredData);
                    updateStats(filteredData);
                    updateQuarantineStats();
                    
                    status.style.display = 'none';
                    document.getElementById('recordInfo').textContent = ` ${allData.length.toLocaleString()} records loaded`;
                    document.getElementById('filters').style.display = 'flex';
                    
                    if (currentDataView === 'table') {
                        tableContainer.style.display = 'block';
                        document.getElementById('cardsContainer').style.display = 'none';
                    } else {
                        tableContainer.style.display = 'none';
                        document.getElementById('cardsContainer').style.display = 'block';
                    }
                    
                    document.getElementById('pagination').style.display = 'flex';
                    if (statsElement) statsElement.style.display = 'grid';
                });

            } catch (error) {
                console.error(' Load Error:', error);
                status.className = 'status error';
                status.textContent = ` Failed to load: ${error.message}`;
                tableContainer.style.display = 'none';
                document.getElementById('cardsContainer').style.display = 'none';
                if (statsElement) statsElement.style.display = 'none';
            } finally {
                loadBtn.disabled = false;
                loadBtn.innerHTML = ' Reload Data';
                getLastModified();
            }
        }

        function processData(rawData) {
            console.log(' Processing raw data...');
            
            // Skip header row and process data
            const processedData = rawData.slice(1).map((row, index) => {
                const processedRow = {};
                
                // Extract only the columns we need
                Object.keys(COLUMNS).forEach(columnName => {
                    const columnIndex = COLUMNS[columnName];
                    if (columnIndex !== undefined && columnIndex < row.length) {
                        let value = row[columnIndex] || '';
                        
                        // Clean and format the value
                        if (typeof value === 'string') {
                            value = value.toString().trim();
                        }
                        
                        processedRow[columnName] = value;
                    } else {
                        processedRow[columnName] = '';
                    }
                });
                
                processedRow.originalIndex = index + 2; // +2 because we skip header and arrays are 0-indexed
                return processedRow;
            }).filter(row => {
                // Filter out completely empty rows
                const hasData = Object.values(row).some(value => 
                    value && value.toString().trim() !== '' && value !== 'originalIndex'
                );
                
                // Also check if at least PRODUK ID or BRAND exists
                const hasKey = row['PRODUK ID'] || row['BRAND'] || row['KODE'];
                
                return hasData && hasKey;
            });
            
            console.log(' Data processing complete:', {
                originalRows: rawData.length - 1,
                processedRows: processedData.length,
                filteredOut: (rawData.length - 1) - processedData.length
            });
            
            return processedData;
        }

        function processDataOptimized(rawData) {
            const processedData = [];
            const columnKeys = Object.keys(COLUMNS);
            const columnIndices = Object.values(COLUMNS);
            
            // Skip header row and process in batches
            for (let i = 1; i < rawData.length; i++) {
                const row = rawData[i];
                const processedRow = {};
                let hasValidData = false;
                
                // Fast column extraction
                for (let j = 0; j < columnKeys.length; j++) {
                    const columnName = columnKeys[j];
                    const columnIndex = columnIndices[j];
                    
                    if (columnIndex !== undefined && columnIndex < row.length) {
                        const value = row[columnIndex];
                        processedRow[columnName] = value ? String(value).trim() : '';
                        if (processedRow[columnName]) hasValidData = true;
                    } else {
                        processedRow[columnName] = '';
                    }
                }
                
                // Quick validation
                if (hasValidData && (processedRow['PRODUK ID'] || processedRow['BRAND'] || processedRow['KODE'])) {
                    processedRow.originalIndex = i + 1;
                    processedData.push(processedRow);
                }
            }
            
            return processedData;
        }

        let currentDataView = 'table';

        function switchDataView(view) {
            const tableContainer = document.getElementById('tableContainer');
            const cardsContainer = document.getElementById('cardsContainer');
            const viewButtons = document.querySelectorAll('.view-btn');
            
            // Update button states
            viewButtons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            currentDataView = view;
            
            if (view === 'table') {
                tableContainer.style.display = 'block';
                cardsContainer.style.display = 'none';
            } else {
                tableContainer.style.display = 'none';
                cardsContainer.style.display = 'block';
            }
            
            // Refresh display with current data
            if (filteredData.length > 0) {
                displayData(filteredData);
            }
        }

        function displayData(data) {
            if (currentDataView === 'table') {
                displayTableData(data);
            } else {
                displayCardData(data);
            }
        }

        function displayTableData(data) {
            const tableBody = document.getElementById('tableBody');
            
            // Calculate pagination
            const totalPages = pageSize === 'all' ? 1 : Math.ceil(data.length / pageSize);
            const startIndex = pageSize === 'all' ? 0 : (currentPage - 1) * pageSize;
            const endIndex = pageSize === 'all' ? data.length : startIndex + pageSize;
            const paginatedData = data.slice(startIndex, endIndex);

            // Use DocumentFragment for better performance
            const fragment = document.createDocumentFragment();
            const columnKeys = Object.keys(COLUMNS);
            const numericColumns = new Set(['QTY MASUK', 'OFFSET', 'SALDO', 'KG']);
            const codeColumns = new Set(['KODE', 'KODE ASAL', 'PRODUK ID']);

            paginatedData.forEach(row => {
                const tr = document.createElement('tr');
                tr.style.cursor = 'pointer';
                tr.onclick = () => openDetailModal(row);
                
                // Optimized cell creation
                columnKeys.forEach(columnName => {
                    const td = document.createElement('td');
                    const value = row[columnName] || '';
                    
                    if (numericColumns.has(columnName)) {
                        td.className = 'numeric';
                        if (value && !isNaN(value)) {
                            td.textContent = parseFloat(value).toLocaleString();
                        } else {
                            td.textContent = value || '-';
                        }
                    } else if (columnName === 'BRAND') {
                        td.className = 'brand-cell';
                        td.textContent = value || '-';
                    } else if (columnName === 'TGL MSK') {
                        td.className = 'date-cell';
                        td.textContent = value || '-';
                    } else if (codeColumns.has(columnName)) {
                        td.className = 'code-cell';
                        td.textContent = value || '-';
                    } else {
                        td.textContent = value || '-';
                    }
                    
                    tr.appendChild(td);
                });
                
                fragment.appendChild(tr);
            });

            // Single DOM update
            tableBody.innerHTML = '';
            tableBody.appendChild(fragment);
            updatePaginationInfo(data.length, totalPages);
        }

        function displayCardData(data) {
            const cardsGrid = document.getElementById('dataCardsGrid');
            
            // Calculate pagination
            const totalPages = pageSize === 'all' ? 1 : Math.ceil(data.length / pageSize);
            const startIndex = pageSize === 'all' ? 0 : (currentPage - 1) * pageSize;
            const endIndex = pageSize === 'all' ? data.length : startIndex + pageSize;
            const paginatedData = data.slice(startIndex, endIndex);

            // Use DocumentFragment for better performance
            const fragment = document.createDocumentFragment();

            paginatedData.forEach(row => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.onclick = () => openDetailModal(row);
                
                // Pre-calculate values to avoid repeated parsing
                const qtyMasuk = row['QTY MASUK'] ? parseFloat(row['QTY MASUK']).toLocaleString() : '0';
                const saldo = row['SALDO'] ? parseFloat(row['SALDO']).toLocaleString() : '0';
                const kg = row['KG'] ? parseFloat(row['KG']).toLocaleString() : '0';
                
                card.innerHTML = `
                    <div class="card-header">
                        <h3 class="card-title">${row['PRODUK ID'] || 'N/A'}</h3>
                        <span class="card-brand">${row['BRAND'] || 'Unknown'}</span>
                    </div>
                    
                    <div class="card-details">
                        <div class="card-detail">
                            <span class="card-detail-label">Size</span>
                            <span class="card-detail-value">${row['SIZE'] || '-'}</span>
                        </div>
                        <div class="card-detail">
                            <span class="card-detail-label">Packing</span>
                            <span class="card-detail-value">${row['PACKING'] || '-'}</span>
                        </div>
                        <div class="card-detail">
                            <span class="card-detail-label">Code</span>
                            <span class="card-detail-value">${row['KODE'] || '-'}</span>
                        </div>
                        <div class="card-detail">
                            <span class="card-detail-label">PO</span>
                            <span class="card-detail-value">${row['PO'] || '-'}</span>
                        </div>
                        <div class="card-detail">
                            <span class="card-detail-label">Date</span>
                            <span class="card-detail-value">${row['TGL MSK'] || '-'}</span>
                        </div>
                    </div>
                    
                    <div class="card-metrics">
                        <div class="card-metric">
                            <span class="card-metric-value">${qtyMasuk}</span>
                            <span class="card-metric-label">Qty Masuk</span>
                        </div>
                        <div class="card-metric">
                            <span class="card-metric-value">${saldo}</span>
                            <span class="card-metric-label">Saldo</span>
                        </div>
                        <div class="card-metric">
                            <span class="card-metric-value">${kg}</span>
                            <span class="card-metric-label">KG</span>
                        </div>
                    </div>
                `;
                
                fragment.appendChild(card);
            });

            // Single DOM update
            cardsGrid.innerHTML = '';
            cardsGrid.appendChild(fragment);
            updatePaginationInfo(data.length, totalPages);
        }

        function updateStats(data) {
            let totalQtyMasuk = 0;
            let totalSaldo = 0;
            let totalKg = 0;
            const uniqueBrands = new Set();

            data.forEach(row => {
                const qtyMasuk = parseFloat(row['QTY MASUK']) || 0;
                const saldo = parseFloat(row['SALDO']) || 0;
                const kg = parseFloat(row['KG']) || 0;
                
                totalQtyMasuk += qtyMasuk;
                totalSaldo += saldo;
                totalKg += kg;
                
                if (row['BRAND']) {
                    uniqueBrands.add(row['BRAND']);
                }
            });

            document.getElementById('totalQty').textContent = totalSaldo.toLocaleString();
            document.getElementById('totalKg').textContent = totalKg.toLocaleString();
            document.getElementById('uniqueBrands').textContent = uniqueBrands.size.toLocaleString();
        }

        // Populate filter dropdowns
        function populateFilters() {
            const brands = [...new Set(allData.map(row => row['BRAND']).filter(brand => brand))].sort();
            const sizes = [...new Set(allData.map(row => row['SIZE']).filter(size => size))].sort();
            const pos = [...new Set(allData.map(row => row['PO']).filter(po => po))].sort();
            const packings = [...new Set(allData.map(row => row['PACKING']).filter(packing => packing))].sort();
            
            const brandFilter = document.getElementById('brandFilter');
            const sizeFilter = document.getElementById('sizeFilter');
            const poFilter = document.getElementById('poFilter');
            const packingFilter = document.getElementById('packingFilter');
            
            brandFilter.innerHTML = '<option value="">All Brands</option>';
            sizeFilter.innerHTML = '<option value="">All Sizes</option>';
            poFilter.innerHTML = '<option value="">All PO</option>';
            packingFilter.innerHTML = '<option value="">All Packing</option>';
            
            brands.forEach(brand => {
                brandFilter.innerHTML += `<option value="${brand}">${brand}</option>`;
            });
            
            sizes.forEach(size => {
                sizeFilter.innerHTML += `<option value="${size}">${size}</option>`;
            });
            
            pos.forEach(po => {
                poFilter.innerHTML += `<option value="${po}">${po}</option>`;
            });
            
            packings.forEach(packing => {
                packingFilter.innerHTML += `<option value="${packing}">${packing}</option>`;
            });
        }

        // Optimized filter application with debouncing
        let filterTimeout;
        function applyFilters() {
            clearTimeout(filterTimeout);
            filterTimeout = setTimeout(() => {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
                const brandFilter = document.getElementById('brandFilter').value;
                const sizeFilter = document.getElementById('sizeFilter').value;
                const poFilter = document.getElementById('poFilter').value;
                const packingFilter = document.getElementById('packingFilter').value;
                const startDate = document.getElementById('startDateFilter').value;
                const endDate = document.getElementById('endDateFilter').value;
                
                // Pre-compile search terms for better performance
                const searchTerms = searchTerm ? searchTerm.split(' ').filter(term => term.length > 0) : [];
                
                filteredData = allData.filter(row => {
                    // Optimized search filter
                    if (searchTerms.length > 0) {
                        const searchableText = [
                            row['PRODUK ID'], row['BRAND'], row['KODE'], 
                            row['KODE ASAL'], row['SIZE'], row['PACKING'], 
                            row['PO'], row['JD']
                        ].join(' ').toLowerCase();
                        
                        if (!searchTerms.every(term => searchableText.includes(term))) {
                            return false;
                        }
                    }
                    
                    // Quick filter checks
                    if (brandFilter && row['BRAND'] !== brandFilter) return false;
                    if (sizeFilter && row['SIZE'] !== sizeFilter) return false;
                    if (poFilter && row['PO'] !== poFilter) return false;
                    if (packingFilter && row['PACKING'] !== packingFilter) return false;
                    
                    // Date range filter (optimized)
                    if (startDate || endDate) {
                        const rowDate = parseDateOptimized(row['TGL MSK']);
                        if (!rowDate) return false;
                        
                        if (startDate && rowDate < new Date(startDate)) return false;
                        if (endDate && rowDate > new Date(endDate)) return false;
                    }
                    
                    return true;
                });
                
                currentPage = 1;
                displayData(filteredData);
                updateStats(filteredData);
            }, 150); // Debounce delay
        }

        // Optimized date parsing
        function parseDateOptimized(dateStr) {
            if (!dateStr) return null;
            
            // Cache parsed dates
            if (!parseDateOptimized.cache) parseDateOptimized.cache = new Map();
            if (parseDateOptimized.cache.has(dateStr)) {
                return parseDateOptimized.cache.get(dateStr);
            }
            
            let date = null;
            try {
                if (dateStr.includes('/')) {
                    const parts = dateStr.split('/');
                    if (parts.length === 3) {
                        date = new Date(parts[2], parts[1] - 1, parts[0]);
                    }
                } else if (dateStr.includes('-')) {
                    date = new Date(dateStr);
                }
            } catch (e) {
                date = null;
            }
            
            parseDateOptimized.cache.set(dateStr, date);
            return date;
        }
        
        // Helper function to parse dates
        function parseDate(dateStr) {
            if (!dateStr) return null;
            
            try {
                if (dateStr.includes('/')) {
                    const parts = dateStr.split('/');
                    if (parts.length === 3) {
                        return new Date(parts[2], parts[1] - 1, parts[0]);
                    }
                } else if (dateStr.includes('-')) {
                    return new Date(dateStr);
                }
            } catch (e) {
                return null;
            }
            return null;
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('brandFilter').value = '';
            document.getElementById('sizeFilter').value = '';
            document.getElementById('poFilter').value = '';
            document.getElementById('packingFilter').value = '';
            document.getElementById('startDateFilter').value = '';
            document.getElementById('endDateFilter').value = '';

            
            filteredData = [...allData];
            currentPage = 1;
            displayData(filteredData);
            updateStats(filteredData);
        }
        

        


        // Sort table
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }
            
            // Update sort indicators
            document.querySelectorAll('.sort-indicator').forEach(indicator => {
                indicator.className = 'sort-indicator';
                indicator.textContent = '';
            });
            
            const currentIndicator = document.getElementById(`sort-${column}`);
            currentIndicator.className = 'sort-indicator active';
            currentIndicator.textContent = sortDirection === 'asc' ? '' : '';
            
            filteredData.sort((a, b) => {
                let aVal = a[column] || '';
                let bVal = b[column] || '';
                
                // Handle numeric columns
                if (['QTY MASUK', 'OFFSET', 'SALDO', 'KG'].includes(column)) {
                    aVal = parseFloat(aVal) || 0;
                    bVal = parseFloat(bVal) || 0;
                } else {
                    aVal = aVal.toString().toLowerCase();
                    bVal = bVal.toString().toLowerCase();
                }
                
                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });
            
            currentPage = 1;
            displayData(filteredData);
        }

        // Pagination functions
        function updatePaginationInfo(totalItems, totalPages) {
            const pageInfo = document.getElementById('pageInfo');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (pageSize === 'all') {
                pageInfo.textContent = `Showing all ${totalItems} items`;
                prevBtn.disabled = true;
                nextBtn.disabled = true;
            } else {
                const startItem = (currentPage - 1) * pageSize + 1;
                const endItem = Math.min(currentPage * pageSize, totalItems);
                pageInfo.textContent = `Showing ${startItem}-${endItem} of ${totalItems} items (Page ${currentPage} of ${totalPages})`;
                
                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage === totalPages || totalPages === 0;
            }
        }

        function changePage(direction) {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                displayData(filteredData);
            }
        }

        function changePageSize() {
            const newPageSize = document.getElementById('pageSizeSelect').value;
            pageSize = newPageSize === 'all' ? 'all' : parseInt(newPageSize);
            currentPage = 1;
            displayData(filteredData);
        }

        // Export to PDF
        function exportToPDF() {
            const headers = Object.keys(COLUMNS);
            const currentDate = new Date().toLocaleDateString();
            
            // Create PDF content
            let pdfContent = `
                <html>
                <head>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .header h1 { color: #374151; margin: 0; }
                        .header p { color: #6b7280; margin: 5px 0; }
                        table { width: 100%; border-collapse: collapse; font-size: 12px; }
                        th, td { border: 1px solid #e5e7eb; padding: 8px; text-align: left; }
                        th { background: #f3f4f6; font-weight: bold; }
                        tr:nth-child(even) { background: #f9fafb; }
                        .numeric { text-align: right; }
                        .footer { margin-top: 20px; text-align: center; font-size: 10px; color: #6b7280; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1> Inventory Report</h1>
                        <p>Generated on ${currentDate}</p>
                        <p>Total Records: ${filteredData.length}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                ${headers.map(header => `<th>${header}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredData.map(row => `
                                <tr>
                                    ${headers.map(header => {
                                        const value = row[header] || '-';
                                        const isNumeric = ['QTY MASUK', 'OFFSET', 'SALDO', 'KG'].includes(header);
                                        return `<td class="${isNumeric ? 'numeric' : ''}">${value}</td>`;
                                    }).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="footer">
                        <p>Inventory Data Viewer - Real-time data from Google Sheets</p>
                    </div>
                </body>
                </html>
            `;
            
            // Create and download PDF
            const printWindow = window.open('', '_blank');
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }

        // Export to Excel
        function exportToExcel() {
            const headers = Object.keys(COLUMNS);
            const currentDate = new Date().toISOString().split('T')[0];
            
            // Create Excel-compatible HTML table
            let excelContent = `
                <html>
                <head>
                    <meta charset="utf-8">
                    <style>
                        table { border-collapse: collapse; width: 100%; }
                        th, td { border: 1px solid #000; padding: 8px; text-align: left; }
                        th { background-color: #f0f0f0; font-weight: bold; }
                        .numeric { text-align: right; }
                    </style>
                </head>
                <body>
                    <h2>Inventory Report - ${currentDate}</h2>
                    <p>Total Records: ${filteredData.length}</p>
                    <table>
                        <thead>
                            <tr>
                                ${headers.map(header => `<th>${header}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredData.map(row => `
                                <tr>
                                    ${headers.map(header => {
                                        const value = row[header] || '';
                                        const isNumeric = ['QTY MASUK', 'OFFSET', 'SALDO', 'KG'].includes(header);
                                        return `<td class="${isNumeric ? 'numeric' : ''}">${value}</td>`;
                                    }).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            // Create blob and download
            const blob = new Blob([excelContent], { 
                type: 'application/vnd.ms-excel;charset=utf-8;' 
            });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `inventory_data_${currentDate}.xls`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Export to CSV
        function exportToCSV() {
            const headers = Object.keys(COLUMNS);
            const currentDate = new Date().toISOString().split('T')[0];
            
            // Create CSV content
            let csvContent = headers.join(',') + '\n';
            
            filteredData.forEach(row => {
                const csvRow = headers.map(header => {
                    const value = row[header] || '';
                    // Escape commas and quotes in CSV
                    const escapedValue = String(value).replace(/"/g, '""');
                    return `"${escapedValue}"`;
                }).join(',');
                csvContent += csvRow + '\n';
            });
            
            // Create blob and download
            const blob = new Blob([csvContent], { 
                type: 'text/csv;charset=utf-8;' 
            });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `inventory_data_${currentDate}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Print Report
        function printReport() {
            const headers = Object.keys(COLUMNS);
            const currentDate = new Date().toLocaleDateString();
            const currentTime = new Date().toLocaleTimeString();
            
            let printContent = `
                <html>
                <head>
                    <title> Inventory Report - ${currentDate}</title>
                    <style>
                        @media print {
                            body { font-family: Arial, sans-serif; margin: 0; padding: 15px; font-size: 11px; }
                            .header { text-align: center; margin-bottom: 25px; background: #f8fafc; padding: 20px; border-radius: 8px; border: 2px solid #2563eb; }
                            .header h1 { color: #2563eb; margin: 0; font-size: 20px; font-weight: 800; }
                            .header p { color: #1e40af; margin: 5px 0; font-weight: 600; }
                            .stats { display: flex; justify-content: space-around; margin: 15px 0; padding: 12px; background: #f0f9ff; border-radius: 6px; }
                            .stat { text-align: center; }
                            .stat-value { font-size: 16px; font-weight: bold; color: #2563eb; }
                            .stat-label { font-size: 10px; color: #1e40af; font-weight: 600; }
                            table { width: 100%; border-collapse: collapse; font-size: 10px; margin-top: 15px; }
                            th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
                            th { background: #2563eb; color: white; font-weight: bold; font-size: 9px; }
                            tr:nth-child(even) { background: #f8fafc; }
                            .numeric { text-align: right; }
                            .footer { margin-top: 20px; text-align: center; font-size: 9px; color: #666; border-top: 2px solid #2563eb; padding-top: 10px; }
                            @page { margin: 1cm; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1> INVENTORY REPORT</h1>
                        <p>Generated on ${currentDate} at ${currentTime}</p>
                        <p>Real-time data from Google Sheets - DETAIL worksheet</p>
                    </div>
                    
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value">${filteredData.length.toLocaleString()}</div>
                            <div class="stat-label">TOTAL ITEMS</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${filteredData.reduce((sum, row) => sum + (parseFloat(row['SALDO']) || 0), 0).toLocaleString()}</div>
                            <div class="stat-label">CURRENT SALDO</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${filteredData.reduce((sum, row) => sum + (parseFloat(row['KG']) || 0), 0).toLocaleString()}</div>
                            <div class="stat-label">TOTAL WEIGHT (KG)</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${[...new Set(filteredData.map(row => row['BRAND']).filter(brand => brand))].length}</div>
                            <div class="stat-label">UNIQUE BRANDS</div>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                ${headers.map(header => `<th>${header}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredData.map(row => `
                                <tr>
                                    ${headers.map(header => {
                                        const value = row[header] || '-';
                                        const isNumeric = ['QTY MASUK', 'OFFSET', 'SALDO', 'KG'].includes(header);
                                        return `<td class="${isNumeric ? 'numeric' : ''}">${value}</td>`;
                                    }).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p><strong> INVENTORY DATA VIEWER</strong> - Real-time data from Google Sheets</p>
                        <p>Report generated on ${currentDate} ${currentTime} | Total Records: ${filteredData.length.toLocaleString()}</p>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        // Memory optimization utilities
        const memoryOptimizer = {
            cleanup() {
                // Clear caches periodically
                if (parseDateOptimized.cache && parseDateOptimized.cache.size > 1000) {
                    parseDateOptimized.cache.clear();
                    console.log(' Date cache cleared');
                }
                
                // Force garbage collection if available
                if (window.gc) {
                    window.gc();
                    console.log(' Garbage collection triggered');
                }
            },
            
            getMemoryUsage() {
                if (performance.memory) {
                    return {
                        used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
                        total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
                        limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024)
                    };
                }
                return null;
            }
        };

        // Periodic memory cleanup
        setInterval(() => {
            memoryOptimizer.cleanup();
            const memory = memoryOptimizer.getMemoryUsage();
            if (memory) {
                console.log(` Memory: ${memory.used}MB / ${memory.total}MB (Limit: ${memory.limit}MB)`);
            }
        }, 300000); // Every 5 minutes

        // Search functionality with optimized event handling
        let searchInputHandler;
        document.getElementById('searchInput').addEventListener('input', function(e) {
            if (searchInputHandler) {
                searchInputHandler.disconnect();
            }
            applyFilters();
        });
        
        // Page navigation
        function showPage(page) {
            const dataElements = ['filters', 'tableContainer', 'cardsContainer', 'pagination', 'stats'];
            const analyticsElements = ['analyticsPage'];
            const quarantineElements = ['quarantinePage'];
            
            // Update tab states
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            if (page === 'data') {
                dataElements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element && allData.length > 0) {
                        if (id === 'filters' || id === 'stats') {
                            element.style.display = 'flex';
                        } else if (id === 'tableContainer') {
                            element.style.display = currentDataView === 'table' ? 'block' : 'none';
                        } else if (id === 'cardsContainer') {
                            element.style.display = currentDataView === 'cards' ? 'block' : 'none';
                        } else {
                            element.style.display = 'block';
                        }
                    }
                });
                analyticsElements.forEach(id => {
                    document.getElementById(id).style.display = 'none';
                });
                quarantineElements.forEach(id => {
                    document.getElementById(id).style.display = 'none';
                });
            } else if (page === 'analytics') {
                dataElements.forEach(id => {
                    document.getElementById(id).style.display = 'none';
                });
                analyticsElements.forEach(id => {
                    document.getElementById(id).style.display = 'block';
                });
                quarantineElements.forEach(id => {
                    document.getElementById(id).style.display = 'none';
                });
                if (allData.length > 0) {
                    generateAnalytics();
                }
            } else if (page === 'quarantine') {
                dataElements.forEach(id => {
                    document.getElementById(id).style.display = 'none';
                });
                analyticsElements.forEach(id => {
                    document.getElementById(id).style.display = 'none';
                });
                quarantineElements.forEach(id => {
                    document.getElementById(id).style.display = 'block';
                });
                if (allData.length > 0) {
                    displayQuarantineData();
                    generateQuarantineAnalytics();
                }
            }
        }

        // Optimized analytics generation with lazy loading
        function generateAnalytics() {
            // Use requestAnimationFrame to prevent blocking
            const analyticsQueue = [
                generateBrandChart,
                generateTopProducts,
                generateSizeDistribution,
                generateDailyKgChart,
                generateBrandPerformance,
                generatePackingAnalysis,
                generatePOPerformance,
                generateMonthlyTrends,
                generateTopCodes,
                generateInventoryDistribution,
                generateWeightAnalytics
            ];

            let currentIndex = 0;
            function processNext() {
                if (currentIndex < analyticsQueue.length) {
                    try {
                        analyticsQueue[currentIndex]();
                    } catch (error) {
                        console.error(`Analytics error in ${analyticsQueue[currentIndex].name}:`, error);
                    }
                    currentIndex++;
                    requestAnimationFrame(processNext);
                }
            }
            
            requestAnimationFrame(processNext);
        }

        function generateBrandChart() {
            const brandData = {};
            allData.forEach(row => {
                const brand = row['BRAND'] || 'Unknown';
                const saldo = parseFloat(row['SALDO']) || 0;
                brandData[brand] = (brandData[brand] || 0) + saldo;
            });

            const sortedBrands = Object.entries(brandData)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8);

            const maxValue = Math.max(...sortedBrands.map(([,value]) => value));
            
            const chartContainer = document.getElementById('brandChart');
            chartContainer.innerHTML = '';

            sortedBrands.forEach(([brand, value]) => {
                const height = (value / maxValue) * 200;
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = height + 'px';
                bar.innerHTML = `
                    <div class="chart-value">${value.toLocaleString()}</div>
                    <div class="chart-label">${brand.length > 8 ? brand.substring(0, 8) + '...' : brand}</div>
                `;
                chartContainer.appendChild(bar);
            });
        }

        function generateTopProducts() {
            // Group by unique combination of PRODUK ID + PACKING + BRAND
            const productGroups = {};
            
            allData.forEach(row => {
                const productId = row['PRODUK ID'] || 'N/A';
                const packing = row['PACKING'] || 'N/A';
                const brand = row['BRAND'] || 'Unknown';
                const uniqueKey = `${productId}|${packing}|${brand}`;
                
                if (!productGroups[uniqueKey]) {
                    productGroups[uniqueKey] = {
                        id: productId,
                        packing: packing,
                        brand: brand,
                        totalQty: 0,
                        totalSaldo: 0,
                        totalKg: 0,
                        items: 0,
                        sizes: new Set()
                    };
                }
                
                productGroups[uniqueKey].totalQty += parseFloat(row['SALDO']) || 0;
                productGroups[uniqueKey].totalSaldo += parseFloat(row['SALDO']) || 0;
                productGroups[uniqueKey].totalKg += parseFloat(row['KG']) || 0;
                productGroups[uniqueKey].items += 1;
                if (row['SIZE']) {
                    productGroups[uniqueKey].sizes.add(row['SIZE']);
                }
            });

            // Sort by total quantity and get top 10
            const topProducts = Object.values(productGroups)
                .sort((a, b) => b.totalQty - a.totalQty)
                .slice(0, 10);

            const container = document.getElementById('topProducts');
            container.innerHTML = '';

            topProducts.forEach((product, index) => {
                const sizesText = Array.from(product.sizes).join(', ') || 'N/A';
                const item = document.createElement('div');
                item.className = 'top-item';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">#${index + 1} ${product.id}</div>
                        <div class="item-details">${product.brand}  ${product.packing}  ${product.items} variants</div>
                        <div class="item-details" style="font-size: 11px; color: #9ca3af;">Sizes: ${sizesText}</div>
                    </div>
                    <div class="item-value">${product.totalQty.toLocaleString()}</div>
                `;
                container.appendChild(item);
            });
        }

        function generateSizeDistribution() {
            const sizeData = {};
            allData.forEach(row => {
                const size = row['SIZE'] || 'Unknown';
                sizeData[size] = (sizeData[size] || 0) + 1;
            });

            const sortedSizes = Object.entries(sizeData)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const total = sortedSizes.reduce((sum, [,count]) => sum + count, 0);
            const colors = ['#2563eb', '#1d4ed8', '#10b981', '#f59e0b', '#ef4444'];
            
            let currentAngle = 0;
            let gradientParts = [];

            sortedSizes.forEach(([size, count], index) => {
                const percentage = (count / total) * 100;
                const angle = (count / total) * 360;
                
                gradientParts.push(`${colors[index]} ${currentAngle}deg ${currentAngle + angle}deg`);
                currentAngle += angle;
            });

            const chart = document.getElementById('sizeChart');
            chart.style.background = `conic-gradient(${gradientParts.join(', ')})`;

            const legend = document.getElementById('sizeLegend');
            legend.innerHTML = '';

            sortedSizes.forEach(([size, count], index) => {
                const percentage = ((count / total) * 100).toFixed(1);
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background: ${colors[index]}"></div>
                    <span>${size}: ${percentage}%</span>
                `;
                legend.appendChild(legendItem);
            });
        }

        // Daily KG Chart - Enhanced with better date parsing and aggregation
        function generateDailyKgChart() {
            const dailyKgData = {};
            const dailyQtyData = {};
            const dailyItemsData = {};
            
            allData.forEach(row => {
                const dateStr = row['TGL MSK'] || '';
                if (dateStr && dateStr.trim() !== '') {
                    try {
                        let date = null;
                        
                        // Enhanced date parsing for multiple formats
                        if (dateStr.includes('/')) {
                            const parts = dateStr.split('/');
                            if (parts.length === 3) {
                                // Handle DD/MM/YYYY format
                                let day = parseInt(parts[0]);
                                let month = parseInt(parts[1]);
                                let year = parseInt(parts[2]);
                                
                                // Handle 2-digit years
                                if (year < 100) {
                                    year += year < 50 ? 2000 : 1900;
                                }
                                
                                if (year > 1900 && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
                                    date = new Date(year, month - 1, day);
                                }
                            }
                        } else if (dateStr.includes('-')) {
                            // Handle YYYY-MM-DD format
                            date = new Date(dateStr);
                        } else if (dateStr.match(/^\d{8}$/)) {
                            // Handle YYYYMMDD format
                            const year = parseInt(dateStr.substring(0, 4));
                            const month = parseInt(dateStr.substring(4, 6));
                            const day = parseInt(dateStr.substring(6, 8));
                            date = new Date(year, month - 1, day);
                        } else if (dateStr.match(/^\d{1,2}\/\d{1,2}\/\d{2,4}$/)) {
                            // Handle flexible DD/MM/YYYY or D/M/YY formats
                            const parts = dateStr.split('/');
                            let day = parseInt(parts[0]);
                            let month = parseInt(parts[1]);
                            let year = parseInt(parts[2]);
                            
                            if (year < 100) {
                                year += year < 50 ? 2000 : 1900;
                            }
                            
                            if (year > 1900 && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
                                date = new Date(year, month - 1, day);
                            }
                        }
                        
                        if (date && !isNaN(date.getTime()) && date.getFullYear() > 1900 && date.getFullYear() < 2100) {
                            const dayKey = date.toISOString().split('T')[0];
                            const kg = parseFloat(row['KG']) || 0;
                            const qty = parseFloat(row['SALDO']) || 0; // Use current saldo for daily stock
                            
                            dailyKgData[dayKey] = (dailyKgData[dayKey] || 0) + kg;
                            dailyQtyData[dayKey] = (dailyQtyData[dayKey] || 0) + qty;
                            dailyItemsData[dayKey] = (dailyItemsData[dayKey] || 0) + 1;
                        }
                    } catch (e) {
                        console.warn('Date parsing error:', dateStr, e);
                    }
                }
            });

            // Get all days with data, sorted chronologically, then take last 14
            const allDays = Object.entries(dailyKgData)
                .filter(([date, kg]) => kg > 0) // Only include days with actual data
                .sort(([a], [b]) => new Date(a) - new Date(b)); // Sort chronologically
            
            const sortedDays = allDays.slice(-14); // Last 14 days

            const chartContainer = document.getElementById('dailyKgChart');
            chartContainer.innerHTML = '';

            if (sortedDays.length === 0) {
                chartContainer.innerHTML = `
                    <div style="text-align: center; color: #6b7280; margin-top: 80px; padding: 20px;">
                        <div style="font-size: 2.5rem; margin-bottom: 15px; opacity: 0.5;"></div>
                        <h4 style="margin: 0 0 8px 0; color: #374151; font-size: 1rem;">No Daily Data Available</h4>
                        <p style="margin: 0; font-size: 0.85rem; color: #6b7280;">Load data with valid dates to view daily trends</p>
                        <p style="margin: 8px 0 0 0; font-size: 0.8rem; color: #9ca3af;">Total entries found: ${allData.length}</p>
                    </div>
                `;
                return;
            }

            const maxKgValue = Math.max(...sortedDays.map(([, kg]) => kg));

            sortedDays.forEach(([date, kg]) => {
                const qty = dailyQtyData[date] || 0;
                const items = dailyItemsData[date] || 0;
                
                // Use KG for height calculation
                const height = maxKgValue > 0 ? (kg / maxKgValue) * 180 : 20;
                
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = height + 'px';
                bar.style.minHeight = '20px';
                
                const dateObj = new Date(date);
                const dayLabel = dateObj.toLocaleDateString('id-ID', { 
                    month: 'short', 
                    day: 'numeric' 
                });
                
                // Enhanced tooltip with more information
                bar.innerHTML = `
                    <div class="chart-value">
                        ${kg.toLocaleString()} kg<br>
                        <small style="font-size: 10px; opacity: 0.8;">
                            ${qty.toLocaleString()} qty  ${items} items
                        </small>
                    </div>
                    <div class="chart-label">${dayLabel}</div>
                `;
                
                // Add hover effect with detailed info
                bar.title = `Date: ${dateObj.toLocaleDateString('id-ID')}\nWeight: ${kg.toLocaleString()} kg\nQuantity: ${qty.toLocaleString()}\nItems: ${items}`;
                
                chartContainer.appendChild(bar);
            });

            // Add summary info below chart
            const totalKg = sortedDays.reduce((sum, [, kg]) => sum + kg, 0);
            const totalQty = sortedDays.reduce((sum, [date]) => sum + (dailyQtyData[date] || 0), 0);
            const avgDaily = sortedDays.length > 0 ? (totalKg / sortedDays.length) : 0;
            
            const summaryDiv = document.createElement('div');
            summaryDiv.style.cssText = `
                margin-top: 15px; 
                padding: 12px; 
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); 
                border-radius: 8px; 
                font-size: 12px; 
                text-align: center;
                border: 1px solid #e2e8f0;
            `;
            summaryDiv.innerHTML = `
                <strong style="color: #374151;"> Daily Summary (${sortedDays.length} days)</strong><br>
                <span style="color: #6b7280;">
                    Total: ${totalKg.toLocaleString()} kg  ${totalQty.toLocaleString()} qty  
                    Avg: ${avgDaily.toFixed(1)} kg/day
                </span>
            `;
            chartContainer.appendChild(summaryDiv);
        }



        // Packing Analysis
        function generatePackingAnalysis() {
            const packingData = {};
            allData.forEach(row => {
                const packing = row['PACKING'] || 'Unknown';
                const qty = parseFloat(row['QTY MASUK']) || 0;
                packingData[packing] = (packingData[packing] || 0) + qty;
            });

            const sortedPacking = Object.entries(packingData)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8);

            const maxValue = Math.max(...sortedPacking.map(([,value]) => value));
            
            const chartContainer = document.getElementById('packingChart');
            chartContainer.innerHTML = '';

            sortedPacking.forEach(([packing, value]) => {
                const height = (value / maxValue) * 200;
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = height + 'px';
                bar.innerHTML = `
                    <div class="chart-value">${value.toLocaleString()}</div>
                    <div class="chart-label">${packing.length > 8 ? packing.substring(0, 8) + '...' : packing}</div>
                `;
                chartContainer.appendChild(bar);
            });
        }

        // PO Performance
        function generatePOPerformance() {
            const poData = {};
            
            allData.forEach(row => {
                const po = row['PO'] || 'Unknown';
                const qty = parseFloat(row['QTY MASUK']) || 0;
                const kg = parseFloat(row['KG']) || 0;
                
                if (!poData[po]) {
                    poData[po] = { qty: 0, kg: 0, items: 0 };
                }
                
                poData[po].qty += qty;
                poData[po].kg += kg;
                poData[po].items += 1;
            });

            const sortedPO = Object.entries(poData)
                .map(([po, data]) => ({
                    po,
                    totalQty: data.qty,
                    totalKg: data.kg,
                    items: data.items,
                    efficiency: data.kg > 0 ? (data.qty / data.kg) : 0
                }))
                .sort((a, b) => b.totalQty - a.totalQty)
                .slice(0, 8);

            const container = document.getElementById('poPerformance');
            container.innerHTML = '';

            sortedPO.forEach((po, index) => {
                const item = document.createElement('div');
                item.className = 'top-item';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">#${index + 1} PO: ${po.po}</div>
                        <div class="item-details">${po.items} items  ${po.totalKg.toLocaleString()} kg  Efficiency: ${po.efficiency.toFixed(2)}</div>
                    </div>
                    <div class="item-value">${po.totalQty.toLocaleString()}</div>
                `;
                container.appendChild(item);
            });
        }



        function generateBrandPerformance() {
            const brandPerformance = {};
            
            allData.forEach(row => {
                const brand = row['BRAND'] || 'Unknown';
                const qty = parseFloat(row['QTY MASUK']) || 0;
                const kg = parseFloat(row['KG']) || 0;
                
                if (!brandPerformance[brand]) {
                    brandPerformance[brand] = { qty: 0, kg: 0, items: 0 };
                }
                
                brandPerformance[brand].qty += qty;
                brandPerformance[brand].kg += kg;
                brandPerformance[brand].items += 1;
            });

            const sortedPerformance = Object.entries(brandPerformance)
                .map(([brand, data]) => ({
                    brand,
                    totalQty: data.qty,
                    totalKg: data.kg,
                    items: data.items,
                    avgQty: data.qty / data.items
                }))
                .sort((a, b) => b.totalQty - a.totalQty)
                .slice(0, 8);

            const container = document.getElementById('brandPerformance');
            container.innerHTML = '';

            sortedPerformance.forEach((brand, index) => {
                const item = document.createElement('div');
                item.className = 'top-item';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">#${index + 1} ${brand.brand}</div>
                        <div class="item-details">${brand.items} items  Avg: ${brand.avgQty.toFixed(1)} qty</div>
                    </div>
                    <div class="item-value">${brand.totalQty.toLocaleString()}</div>
                `;
                container.appendChild(item);
            });
        }

        // Toggle filters visibility
        function toggleFilters() {
            const content = document.getElementById('filtersContent');
            const btn = document.getElementById('toggleFiltersBtn');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                btn.innerHTML = ' Hide Filters';
                btn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            } else {
                content.style.display = 'none';
                btn.innerHTML = ' Show Filters';
                btn.style.background = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
            }
        }

        // Filter change listeners
        document.getElementById('brandFilter').addEventListener('change', applyFilters);
        document.getElementById('sizeFilter').addEventListener('change', applyFilters);
        document.getElementById('poFilter').addEventListener('change', applyFilters);
        document.getElementById('packingFilter').addEventListener('change', applyFilters);
        document.getElementById('startDateFilter').addEventListener('change', applyFilters);
        document.getElementById('endDateFilter').addEventListener('change', applyFilters);


        // Allow Enter key to trigger load
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.activeElement.id !== 'searchInput') {
                loadData();
            }
        });

        // Create animated particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Performance monitoring
        const performanceMonitor = {
            startTime: null,
            metrics: {},
            
            start(operation) {
                this.startTime = performance.now();
                console.log(` Starting ${operation}...`);
            },
            
            end(operation) {
                if (this.startTime) {
                    const duration = performance.now() - this.startTime;
                    this.metrics[operation] = duration;
                    console.log(` ${operation} completed in ${duration.toFixed(2)}ms`);
                    this.startTime = null;
                }
            },
            
            getReport() {
                return this.metrics;
            }
        };

        // Auto-load data when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            performanceMonitor.start('Application Initialization');
            console.log(' Initializing Inventory Data Viewer...');
            
            try {
                // Validate API connection first
                performanceMonitor.start('API Validation');
                const isConnected = await validateConnection();
                performanceMonitor.end('API Validation');
                
                if (!isConnected) {
                    document.getElementById('status').className = 'status error';
                    document.getElementById('status').textContent = ' Cannot connect to Google Sheets API. Please check your connection.';
                    return;
                }
                
                // Get last modified time first
                performanceMonitor.start('Last Modified Check');
                await getLastModified();
                performanceMonitor.end('Last Modified Check');
                
                // Auto-load data
                performanceMonitor.start('Data Loading');
                await loadData();
                performanceMonitor.end('Data Loading');
                
                performanceMonitor.end('Application Initialization');
                console.log(' Initialization complete');
                console.log(' Performance Report:', performanceMonitor.getReport());
                
            } catch (error) {
                console.error(' Initialization failed:', error);
                document.getElementById('status').className = 'status error';
                document.getElementById('status').textContent = ` Initialization failed: ${error.message}`;
            }
        });

        // Modal Functions
        function openTableModal() {
            if (filteredData.length === 0) {
                alert('Please load data first!');
                return;
            }
            
            document.getElementById('tableModal').style.display = 'block';
            populateModalTable(filteredData);
            setupModalSearch();
        }

        function openCardModal() {
            if (filteredData.length === 0) {
                alert('Please load data first!');
                return;
            }
            
            document.getElementById('cardModal').style.display = 'block';
            populateCardModal(filteredData);
            setupCardModalSearch();
        }

        function openDetailModal(item) {
            document.getElementById('detailModal').style.display = 'block';
            populateDetailModal(item);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function populateModalTable(data) {
            const tbody = document.getElementById('modalTableBody');
            tbody.innerHTML = '';

            data.slice(0, 100).forEach(row => { // Limit to 100 items for performance
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="code-cell">${row['PRODUK ID'] || '-'}</td>
                    <td class="brand-cell">${row['BRAND'] || '-'}</td>
                    <td>${row['SIZE'] || '-'}</td>
                    <td class="code-cell">${row['KODE'] || '-'}</td>
                    <td class="numeric">${row['QTY MASUK'] ? parseFloat(row['QTY MASUK']).toLocaleString() : '-'}</td>
                    <td class="numeric">${row['SALDO'] ? parseFloat(row['SALDO']).toLocaleString() : '-'}</td>
                    <td class="numeric">${row['KG'] ? parseFloat(row['KG']).toLocaleString() : '-'}</td>
                    <td>
                        <button onclick="openDetailModal(${JSON.stringify(row).replace(/"/g, '&quot;')})" 
                                style="background: #667eea; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            View Details
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // Update modal stats
            updateModalStats(data);
        }

        function populateCardModal(data) {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';

            data.slice(0, 50).forEach(row => { // Limit to 50 cards for performance
                const card = document.createElement('div');
                card.className = 'item-card';
                card.onclick = () => openDetailModal(row);
                
                card.innerHTML = `
                    <div class="card-header">
                        <h3 class="card-title">${row['PRODUK ID'] || 'N/A'}</h3>
                        <span class="card-brand">${row['BRAND'] || 'Unknown'}</span>
                    </div>
                    
                    <div class="card-details">
                        <div class="card-detail">
                            <span class="card-detail-label">Size</span>
                            <span class="card-detail-value">${row['SIZE'] || '-'}</span>
                        </div>
                        <div class="card-detail">
                            <span class="card-detail-label">Code</span>
                            <span class="card-detail-value">${row['KODE'] || '-'}</span>
                        </div>
                        <div class="card-detail">
                            <span class="card-detail-label">PO</span>
                            <span class="card-detail-value">${row['PO'] || '-'}</span>
                        </div>
                        <div class="card-detail">
                            <span class="card-detail-label">Date</span>
                            <span class="card-detail-value">${row['TGL MSK'] || '-'}</span>
                        </div>
                    </div>
                    
                    <div class="card-metrics">
                        <div class="card-metric">
                            <span class="card-metric-value">${row['QTY MASUK'] ? parseFloat(row['QTY MASUK']).toLocaleString() : '0'}</span>
                            <span class="card-metric-label">Qty Masuk</span>
                        </div>
                        <div class="card-metric">
                            <span class="card-metric-value">${row['SALDO'] ? parseFloat(row['SALDO']).toLocaleString() : '0'}</span>
                            <span class="card-metric-label">Saldo</span>
                        </div>
                        <div class="card-metric">
                            <span class="card-metric-value">${row['KG'] ? parseFloat(row['KG']).toLocaleString() : '0'}</span>
                            <span class="card-metric-label">KG</span>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function populateDetailModal(item) {
            document.getElementById('detailTitle').textContent = item['PRODUK ID'] || 'Unknown Product';
            document.getElementById('detailSubtitle').textContent = `${item['BRAND'] || 'Unknown Brand'}  ${item['SIZE'] || 'Unknown Size'}`;
            document.getElementById('detailSaldo').textContent = item['SALDO'] ? parseFloat(item['SALDO']).toLocaleString() : '0';
            
            // Product Information
            document.getElementById('detailProductId').textContent = item['PRODUK ID'] || '-';
            document.getElementById('detailBrand').textContent = item['BRAND'] || '-';
            document.getElementById('detailSize').textContent = item['SIZE'] || '-';
            document.getElementById('detailCode').textContent = item['KODE'] || '-';
            document.getElementById('detailCodeAsal').textContent = item['KODE ASAL'] || '-';
            
            // Inventory Details
            document.getElementById('detailQtyMasuk').textContent = item['QTY MASUK'] ? parseFloat(item['QTY MASUK']).toLocaleString() : '-';
            document.getElementById('detailOffset').textContent = item['OFFSET'] ? parseFloat(item['OFFSET']).toLocaleString() : '-';
            document.getElementById('detailKg').textContent = item['KG'] ? parseFloat(item['KG']).toLocaleString() + ' kg' : '-';
            document.getElementById('detailPacking').textContent = item['PACKING'] || '-';
            document.getElementById('detailTglMasuk').textContent = item['TGL MSK'] || '-';
            
            // Order Information
            document.getElementById('detailPo').textContent = item['PO'] || '-';
            document.getElementById('detailJd').textContent = item['JD'] || '-';
        }

        function switchModalView(view) {
            const tableView = document.getElementById('modalTableView');
            const summaryView = document.getElementById('modalSummaryView');
            const buttons = document.querySelectorAll('.view-btn');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (view === 'table') {
                tableView.style.display = 'block';
                summaryView.style.display = 'none';
                buttons[0].classList.add('active');
            } else {
                tableView.style.display = 'none';
                summaryView.style.display = 'block';
                buttons[1].classList.add('active');
            }
        }

        function updateModalStats(data) {
            const totalItems = data.length;
            const totalQty = data.reduce((sum, row) => sum + (parseFloat(row['QTY MASUK']) || 0), 0);
            const totalWeight = data.reduce((sum, row) => sum + (parseFloat(row['KG']) || 0), 0);
            
            document.getElementById('modalTotalItems').textContent = totalItems.toLocaleString();
            document.getElementById('modalTotalQty').textContent = totalQty.toLocaleString();
            document.getElementById('modalTotalWeight').textContent = totalWeight.toLocaleString() + ' kg';
        }

        function setupModalSearch() {
            const searchInput = document.getElementById('modalSearchInput');
            let searchTimeout;
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = this.value.toLowerCase().trim();
                    const filtered = filteredData.filter(row => 
                        Object.values(row).some(value => 
                            value && value.toString().toLowerCase().includes(searchTerm)
                        )
                    );
                    populateModalTable(filtered);
                }, 300);
            });
        }

        function setupCardModalSearch() {
            const searchInput = document.getElementById('cardModalSearchInput');
            let searchTimeout;
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = this.value.toLowerCase().trim();
                    const filtered = filteredData.filter(row => 
                        Object.values(row).some(value => 
                            value && value.toString().toLowerCase().includes(searchTerm)
                        )
                    );
                    populateCardModal(filtered);
                }, 300);
            });
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modals = ['tableModal', 'cardModal', 'detailModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    closeModal(modalId);
                }
            });
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modals = ['tableModal', 'cardModal', 'detailModal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (modal.style.display === 'block') {
                        closeModal(modalId);
                    }
                });
            }
        });

        // Quarantine Functions
        function updateQuarantineStats() {
            // Group by unique combination of PRODUK ID + PACKING + BRAND for quarantine items
            const uniqueQuarantineGroups = {};
            let totalQtyMasuk = 0;
            let totalSaldo = 0;
            let totalWeight = 0;
            let totalOutgoing = 0; // Qty Masuk - Saldo

            quarantineData.forEach(row => {
                const productId = row['PRODUK ID'] || 'N/A';
                const packing = row['PACKING'] || 'N/A';
                const brand = row['BRAND'] || 'Unknown';
                const uniqueKey = `${productId}|${packing}|${brand}`;
                
                const qtyMasuk = parseFloat(row['QTY MASUK']) || 0;
                const saldo = parseFloat(row['SALDO']) || 0;
                const kg = parseFloat(row['KG']) || 0;
                const outgoing = qtyMasuk - saldo; // Calculate outgoing quantity
                
                if (!uniqueQuarantineGroups[uniqueKey]) {
                    uniqueQuarantineGroups[uniqueKey] = {
                        productId: productId,
                        packing: packing,
                        brand: brand,
                        totalQtyMasuk: 0,
                        totalSaldo: 0,
                        totalKg: 0,
                        totalOutgoing: 0,
                        items: 0
                    };
                }
                
                uniqueQuarantineGroups[uniqueKey].totalQtyMasuk += qtyMasuk;
                uniqueQuarantineGroups[uniqueKey].totalSaldo += saldo;
                uniqueQuarantineGroups[uniqueKey].totalKg += kg;
                uniqueQuarantineGroups[uniqueKey].totalOutgoing += Math.max(0, outgoing); // Only positive outgoing
                uniqueQuarantineGroups[uniqueKey].items += 1;
                
                totalQtyMasuk += qtyMasuk;
                totalSaldo += saldo;
                totalWeight += kg;
                totalOutgoing += Math.max(0, outgoing);
            });

            const uniqueProductCount = Object.keys(uniqueQuarantineGroups).length;

            document.getElementById('quarantineTotal').textContent = uniqueProductCount.toLocaleString();
            document.getElementById('quarantineQty').textContent = totalSaldo.toLocaleString();
            document.getElementById('quarantineWeight').textContent = totalWeight.toLocaleString();
            document.getElementById('quarantineQtyMasuk').textContent = totalQtyMasuk.toLocaleString();
            document.getElementById('quarantineOutgoing').textContent = totalOutgoing.toLocaleString();
            
            // Store for analytics
            window.quarantineGroups = uniqueQuarantineGroups;
            window.quarantineTotals = {
                uniqueProducts: uniqueProductCount,
                totalQtyMasuk: totalQtyMasuk,
                totalSaldo: totalSaldo,
                totalWeight: totalWeight,
                totalOutgoing: totalOutgoing
            };
        }

        function displayQuarantineData() {
            const tableBody = document.getElementById('quarantineTableBody');
            const emptyState = document.getElementById('quarantineEmpty');
            const tableContainer = document.getElementById('quarantineTableContainer');

            if (filteredQuarantineData.length === 0) {
                tableContainer.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            tableContainer.style.display = 'block';
            emptyState.style.display = 'none';
            tableBody.innerHTML = '';

            filteredQuarantineData.forEach(row => {
                const tr = document.createElement('tr');
                tr.style.cursor = 'pointer';
                tr.onclick = () => openDetailModal(row);
                
                tr.innerHTML = `
                    <td class="code-cell">${row['PRODUK ID'] || '-'}</td>
                    <td style="background: #fef2f2; color: #dc2626; font-weight: 600; padding: 8px 12px;">
                         ${row['BRAND'] || 'Unknown'}
                    </td>
                    <td>${row['SIZE'] || '-'}</td>
                    <td class="code-cell">${row['KODE'] || '-'}</td>
                    <td class="code-cell">${row['KODE ASAL'] || '-'}</td>
                    <td class="numeric">${row['QTY MASUK'] ? parseFloat(row['QTY MASUK']).toLocaleString() : '-'}</td>
                    <td class="numeric">${row['SALDO'] ? parseFloat(row['SALDO']).toLocaleString() : '-'}</td>
                    <td class="numeric">${row['KG'] ? parseFloat(row['KG']).toLocaleString() : '-'}</td>
                    <td class="date-cell">${row['TGL MSK'] || '-'}</td>
                    <td>
                        <button onclick="event.stopPropagation(); openDetailModal(${JSON.stringify(row).replace(/"/g, '&quot;')})" 
                                style="background: #dc2626; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500;">
                             Details
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(tr);
            });
        }

        function applyQuarantineFilters() {
            const searchTerm = document.getElementById('quarantineSearchInput').value.toLowerCase().trim();
            
            filteredQuarantineData = quarantineData.filter(row => {
                if (searchTerm === '') return true;
                
                // Search across all relevant fields
                const searchFields = [
                    row['PRODUK ID'] || '',
                    row['BRAND'] || '',
                    row['KODE'] || '',
                    row['KODE ASAL'] || '',
                    row['SIZE'] || '',
                    row['PACKING'] || '',
                    row['PO'] || '',
                    row['JD'] || '',
                    row['TGL MSK'] || ''
                ];
                
                return searchFields.some(field => 
                    field.toString().toLowerCase().includes(searchTerm)
                );
            });
            
            displayQuarantineData();
            updateQuarantineSearchStats();
        }

        function updateQuarantineSearchStats() {
            const foundCount = filteredQuarantineData.length;
            const totalSaldo = filteredQuarantineData.reduce((sum, row) => 
                sum + (parseFloat(row['SALDO']) || 0), 0);
            
            document.getElementById('quarantineSearchCount').textContent = foundCount.toLocaleString();
            document.getElementById('quarantineSearchSaldo').textContent = totalSaldo.toLocaleString();
        }

        function printQuarantineReport() {
            const currentDate = new Date().toLocaleDateString();
            const currentTime = new Date().toLocaleTimeString();
            
            let printContent = `
                <html>
                <head>
                    <title> QUARANTINE ALERT REPORT - ${currentDate}</title>
                    <style>
                        @media print {
                            body { font-family: Arial, sans-serif; margin: 0; padding: 15px; font-size: 11px; }
                            .header { text-align: center; margin-bottom: 25px; background: #fef2f2; padding: 20px; border-radius: 8px; border: 2px solid #dc2626; }
                            .header h1 { color: #dc2626; margin: 0; font-size: 20px; font-weight: 800; }
                            .header p { color: #991b1b; margin: 5px 0; font-weight: 600; }
                            .alert-box { background: #fef2f2; border: 2px solid #fecaca; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                            .alert-box h3 { color: #dc2626; margin: 0 0 10px 0; font-size: 14px; }
                            .stats { display: flex; justify-content: space-around; margin: 15px 0; padding: 12px; background: #fff7ed; border-radius: 6px; }
                            .stat { text-align: center; }
                            .stat-value { font-size: 16px; font-weight: bold; color: #dc2626; }
                            .stat-label { font-size: 10px; color: #991b1b; font-weight: 600; }
                            table { width: 100%; border-collapse: collapse; font-size: 10px; margin-top: 15px; }
                            th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
                            th { background: #dc2626; color: white; font-weight: bold; font-size: 9px; }
                            tr:nth-child(even) { background: #fef2f2; }
                            .numeric { text-align: right; }
                            .quarantine-brand { background: #fef2f2; color: #dc2626; font-weight: bold; }
                            .footer { margin-top: 20px; text-align: center; font-size: 9px; color: #666; border-top: 2px solid #dc2626; padding-top: 10px; }
                            .critical { color: #dc2626; font-weight: bold; }
                            @page { margin: 1cm; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1> CRITICAL QUARANTINE ALERT REPORT</h1>
                        <p>Generated on ${currentDate} at ${currentTime}</p>
                        <p class="critical"> IMMEDIATE ATTENTION REQUIRED </p>
                    </div>
                    
                    <div class="alert-box">
                        <h3> QUARANTINE STATUS ALERT</h3>
                        <p><strong>Total Items in Quarantine:</strong> ${filteredQuarantineData.length.toLocaleString()}</p>
                        <p><strong>Risk Level:</strong> HIGH - Requires immediate quality control intervention</p>
                        <p><strong>Action Required:</strong> Review all items below and initiate appropriate quarantine procedures</p>
                    </div>
                    
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value">${filteredQuarantineData.length.toLocaleString()}</div>
                            <div class="stat-label">QUARANTINE ITEMS</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${filteredQuarantineData.reduce((sum, row) => sum + (parseFloat(row['SALDO']) || 0), 0).toLocaleString()}</div>
                            <div class="stat-label">CURRENT SALDO</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${filteredQuarantineData.reduce((sum, row) => sum + (parseFloat(row['KG']) || 0), 0).toLocaleString()}</div>
                            <div class="stat-label">TOTAL WEIGHT (KG)</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${[...new Set(filteredQuarantineData.map(row => row['BRAND']).filter(brand => brand))].length}</div>
                            <div class="stat-label">AFFECTED BRANDS</div>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>PRODUCT ID</th>
                                <th>BRAND STATUS</th>
                                <th>SIZE</th>
                                <th>CODE</th>
                                <th>CODE ASAL</th>
                                <th>QTY MASUK</th>
                                <th>SALDO</th>
                                <th>KG</th>
                                <th>DATE MASUK</th>
                                <th>RISK LEVEL</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredQuarantineData.map(row => {
                                const saldo = parseFloat(row['SALDO']) || 0;
                                const qtyMasuk = parseFloat(row['QTY MASUK']) || 0;
                                const retentionRate = qtyMasuk > 0 ? (saldo / qtyMasuk) * 100 : 0;
                                const riskLevel = retentionRate > 70 ? 'HIGH' : retentionRate > 40 ? 'MEDIUM' : 'LOW';
                                const riskColor = retentionRate > 70 ? '#dc2626' : retentionRate > 40 ? '#ea580c' : '#f59e0b';
                                
                                return `
                                <tr>
                                    <td>${row['PRODUK ID'] || '-'}</td>
                                    <td class="quarantine-brand"> ${row['BRAND'] || 'Unknown'}</td>
                                    <td>${row['SIZE'] || '-'}</td>
                                    <td>${row['KODE'] || '-'}</td>
                                    <td>${row['KODE ASAL'] || '-'}</td>
                                    <td class="numeric">${row['QTY MASUK'] || '-'}</td>
                                    <td class="numeric">${row['SALDO'] || '-'}</td>
                                    <td class="numeric">${row['KG'] || '-'}</td>
                                    <td>${row['TGL MSK'] || '-'}</td>
                                    <td style="color: ${riskColor}; font-weight: bold;">${riskLevel}</td>
                                </tr>
                            `}).join('')}
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p><strong> QUARANTINE MANAGEMENT SYSTEM</strong> - Inventory Data Viewer</p>
                        <p class="critical"> This report contains ${filteredQuarantineData.length.toLocaleString()} items requiring immediate quality control attention</p>
                        <p>Report generated on ${currentDate} ${currentTime} | Status: CRITICAL ALERT</p>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        function exportQuarantineReport() {
            const currentDate = new Date().toLocaleDateString();
            
            let pdfContent = `
                <html>
                <head>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; background: #fef2f2; padding: 20px; border-radius: 8px; }
                        .header h1 { color: #dc2626; margin: 0; }
                        .header p { color: #991b1b; margin: 5px 0; }
                        .alert { background: #fef2f2; border: 2px solid #fecaca; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                        .alert h3 { color: #dc2626; margin: 0 0 10px 0; }
                        table { width: 100%; border-collapse: collapse; font-size: 12px; }
                        th, td { border: 1px solid #e5e7eb; padding: 8px; text-align: left; }
                        th { background: #dc2626; color: white; font-weight: bold; }
                        tr:nth-child(even) { background: #fef2f2; }
                        .numeric { text-align: right; }
                        .footer { margin-top: 20px; text-align: center; font-size: 10px; color: #6b7280; }
                        .quarantine-brand { background: #fef2f2; color: #dc2626; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1> QUARANTINE REPORT</h1>
                        <p>Generated on ${currentDate}</p>
                        <p>Total Quarantine Items: ${filteredQuarantineData.length}</p>
                    </div>
                    
                    <div class="alert">
                        <h3> ATTENTION REQUIRED</h3>
                        <p>The following items are currently in quarantine status and require immediate attention from the quality control team.</p>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Product ID</th>
                                <th>Brand Status</th>
                                <th>Size</th>
                                <th>Code</th>
                                <th>Code Asal</th>
                                <th>Qty Masuk</th>
                                <th>Saldo</th>
                                <th>KG</th>
                                <th>Date Masuk</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredQuarantineData.map(row => `
                                <tr>
                                    <td>${row['PRODUK ID'] || '-'}</td>
                                    <td class="quarantine-brand"> ${row['BRAND'] || 'Unknown'}</td>
                                    <td>${row['SIZE'] || '-'}</td>
                                    <td>${row['KODE'] || '-'}</td>
                                    <td>${row['KODE ASAL'] || '-'}</td>
                                    <td class="numeric">${row['QTY MASUK'] || '-'}</td>
                                    <td class="numeric">${row['SALDO'] || '-'}</td>
                                    <td class="numeric">${row['KG'] || '-'}</td>
                                    <td>${row['TGL MSK'] || '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="footer">
                        <p>Quarantine Management System - Inventory Data Viewer</p>
                        <p style="color: #dc2626; font-weight: bold;"> This report contains items requiring immediate quality control attention</p>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 250);
        }



        // Monthly Trends - Enhanced with comprehensive monthly analytics
        function generateMonthlyTrends() {
            const monthlyData = {};
            
            allData.forEach(row => {
                const dateStr = row['TGL MSK'] || '';
                if (dateStr && dateStr.trim() !== '') {
                    try {
                        let date = null;
                        
                        // Enhanced date parsing for multiple formats
                        if (dateStr.includes('/')) {
                            const parts = dateStr.split('/');
                            if (parts.length === 3) {
                                // Handle DD/MM/YYYY format
                                let day = parseInt(parts[0]);
                                let month = parseInt(parts[1]);
                                let year = parseInt(parts[2]);
                                
                                // Handle 2-digit years
                                if (year < 100) {
                                    year += year < 50 ? 2000 : 1900;
                                }
                                
                                if (year > 1900 && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
                                    date = new Date(year, month - 1, day);
                                }
                            }
                        } else if (dateStr.includes('-')) {
                            // Handle YYYY-MM-DD format
                            date = new Date(dateStr);
                        } else if (dateStr.match(/^\d{8}$/)) {
                            // Handle YYYYMMDD format
                            const year = parseInt(dateStr.substring(0, 4));
                            const month = parseInt(dateStr.substring(4, 6));
                            const day = parseInt(dateStr.substring(6, 8));
                            date = new Date(year, month - 1, day);
                        } else if (dateStr.match(/^\d{1,2}\/\d{1,2}\/\d{2,4}$/)) {
                            // Handle flexible DD/MM/YYYY or D/M/YY formats
                            const parts = dateStr.split('/');
                            let day = parseInt(parts[0]);
                            let month = parseInt(parts[1]);
                            let year = parseInt(parts[2]);
                            
                            if (year < 100) {
                                year += year < 50 ? 2000 : 1900;
                            }
                            
                            if (year > 1900 && month >= 1 && month <= 12 && day >= 1 && day <= 31) {
                                date = new Date(year, month - 1, day);
                            }
                        }
                        
                        if (date && !isNaN(date.getTime()) && date.getFullYear() > 1900 && date.getFullYear() < 2100) {
                            const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                            const monthLabel = date.toLocaleDateString('id-ID', { 
                                year: 'numeric', 
                                month: 'short' 
                            });
                            
                            if (!monthlyData[monthKey]) {
                                monthlyData[monthKey] = {
                                    label: monthLabel,
                                    qtyMasuk: 0,
                                    saldo: 0,
                                    kg: 0,
                                    items: 0,
                                    uniqueProducts: new Set(),
                                    brands: new Set()
                                };
                            }
                            
                            const qtyMasuk = parseFloat(row['QTY MASUK']) || 0;
                            const saldo = parseFloat(row['SALDO']) || 0;
                            const kg = parseFloat(row['KG']) || 0;
                            const productId = row['PRODUK ID'] || '';
                            const brand = row['BRAND'] || '';
                            
                            monthlyData[monthKey].qtyMasuk += qtyMasuk;
                            monthlyData[monthKey].saldo += saldo;
                            monthlyData[monthKey].kg += kg;
                            monthlyData[monthKey].items += 1;
                            
                            if (productId) monthlyData[monthKey].uniqueProducts.add(productId);
                            if (brand) monthlyData[monthKey].brands.add(brand);
                        }
                    } catch (e) {
                        console.warn('Monthly date parsing error:', dateStr, e);
                    }
                }
            });

            // Convert sets to counts and sort by date
            const processedMonthlyData = Object.entries(monthlyData)
                .map(([key, data]) => ({
                    key,
                    label: data.label,
                    qtyMasuk: data.qtyMasuk,
                    saldo: data.saldo,
                    kg: data.kg,
                    items: data.items,
                    uniqueProducts: data.uniqueProducts.size,
                    brands: data.brands.size,
                    date: new Date(key + '-01')
                }))
                .sort((a, b) => a.date - b.date)
                .slice(-8); // Last 8 months

            const chartContainer = document.getElementById('monthlyTrendsChart');
            chartContainer.innerHTML = '';

            if (processedMonthlyData.length === 0) {
                chartContainer.innerHTML = `
                    <div style="text-align: center; color: #6b7280; margin-top: 80px; padding: 20px;">
                        <div style="font-size: 2.5rem; margin-bottom: 15px; opacity: 0.5;"></div>
                        <h4 style="margin: 0 0 8px 0; color: #374151; font-size: 1rem;">No Monthly Data Available</h4>
                        <p style="margin: 0; font-size: 0.85rem; color: #6b7280;">Load data with valid dates to view monthly trends</p>
                        <p style="margin: 8px 0 0 0; font-size: 0.8rem; color: #9ca3af;">Total entries found: ${allData.length}</p>
                    </div>
                `;
                return;
            }

            // Use multiple metrics for comprehensive view
            const maxQtyMasuk = Math.max(...processedMonthlyData.map(d => d.qtyMasuk));
            const maxSaldo = Math.max(...processedMonthlyData.map(d => d.saldo));
            const maxKg = Math.max(...processedMonthlyData.map(d => d.kg));
            
            // Use the highest metric for scaling
            const maxValue = Math.max(maxQtyMasuk, maxSaldo, maxKg);

            processedMonthlyData.forEach((monthData, index) => {
                // Use saldo as primary metric for height
                const height = maxValue > 0 ? (monthData.saldo / maxValue) * 180 : 20;
                
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = height + 'px';
                bar.style.minHeight = '20px';
                
                // Color gradient based on performance
                const performance = maxValue > 0 ? (monthData.saldo / maxValue) : 0;
                let gradient;
                if (performance > 0.7) {
                    gradient = 'linear-gradient(135deg, #10b981 0%, #059669 100%)'; // Green for high
                } else if (performance > 0.4) {
                    gradient = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'; // Orange for medium
                } else {
                    gradient = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'; // Red for low
                }
                bar.style.background = gradient;
                
                // Enhanced tooltip with comprehensive data
                bar.innerHTML = `
                    <div class="chart-value">
                        ${monthData.saldo.toLocaleString()}<br>
                        <small style="font-size: 9px; opacity: 0.8;">
                            ${monthData.kg.toLocaleString()} kg<br>
                            ${monthData.uniqueProducts} products
                        </small>
                    </div>
                    <div class="chart-label">${monthData.label.replace(' ', '\n')}</div>
                `;
                
                // Detailed hover information
                bar.title = `${monthData.label}
Qty Masuk: ${monthData.qtyMasuk.toLocaleString()}
Current Saldo: ${monthData.saldo.toLocaleString()}
Weight: ${monthData.kg.toLocaleString()} kg
Items: ${monthData.items.toLocaleString()}
Unique Products: ${monthData.uniqueProducts}
Brands: ${monthData.brands}`;
                
                chartContainer.appendChild(bar);
            });

            // Add comprehensive monthly summary
            const totalQtyMasuk = processedMonthlyData.reduce((sum, d) => sum + d.qtyMasuk, 0);
            const totalSaldo = processedMonthlyData.reduce((sum, d) => sum + d.saldo, 0);
            const totalKg = processedMonthlyData.reduce((sum, d) => sum + d.kg, 0);
            const totalItems = processedMonthlyData.reduce((sum, d) => sum + d.items, 0);
            const avgMonthlySaldo = processedMonthlyData.length > 0 ? (totalSaldo / processedMonthlyData.length) : 0;
            
            // Calculate trend (comparing first and last month)
            let trendIndicator = '';
            let trendText = 'Stable';
            let trendColor = '#6b7280';
            
            if (processedMonthlyData.length >= 2) {
                const firstMonth = processedMonthlyData[0].saldo;
                const lastMonth = processedMonthlyData[processedMonthlyData.length - 1].saldo;
                const trendPercentage = firstMonth > 0 ? ((lastMonth - firstMonth) / firstMonth * 100) : 0;
                
                if (trendPercentage > 10) {
                    trendIndicator = '';
                    trendText = `Growing (+${trendPercentage.toFixed(1)}%)`;
                    trendColor = '#10b981';
                } else if (trendPercentage < -10) {
                    trendIndicator = '';
                    trendText = `Declining (${trendPercentage.toFixed(1)}%)`;
                    trendColor = '#ef4444';
                }
            }
            
            const summaryDiv = document.createElement('div');
            summaryDiv.style.cssText = `
                margin-top: 15px; 
                padding: 15px; 
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); 
                border-radius: 10px; 
                font-size: 12px; 
                border: 1px solid #e2e8f0;
            `;
            summaryDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <strong style="color: #374151;"> Monthly Trends (${processedMonthlyData.length} months)</strong>
                    <span style="color: ${trendColor}; font-weight: 600;">${trendIndicator} ${trendText}</span>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center;">
                    <div>
                        <div style="font-weight: 600; color: #2563eb;">${totalSaldo.toLocaleString()}</div>
                        <div style="font-size: 10px; color: #6b7280;">Total Saldo</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #059669;">${totalKg.toLocaleString()} kg</div>
                        <div style="font-size: 10px; color: #6b7280;">Total Weight</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #d97706;">${avgMonthlySaldo.toFixed(0)}</div>
                        <div style="font-size: 10px; color: #6b7280;">Avg/Month</div>
                    </div>
                </div>
            `;
            chartContainer.appendChild(summaryDiv);
        }



        // Top Performing Codes
        function generateTopCodes() {
            const codeData = {};
            
            allData.forEach(row => {
                const code = row['KODE'] || 'Unknown';
                const saldo = parseFloat(row['SALDO']) || 0;
                const kg = parseFloat(row['KG']) || 0;
                
                if (!codeData[code]) {
                    codeData[code] = { saldo: 0, kg: 0, items: 0 };
                }
                
                codeData[code].saldo += saldo;
                codeData[code].kg += kg;
                codeData[code].items += 1;
            });

            const sortedCodes = Object.entries(codeData)
                .map(([code, data]) => ({
                    code,
                    totalSaldo: data.saldo,
                    totalKg: data.kg,
                    items: data.items,
                    density: data.kg > 0 ? (data.saldo / data.kg) : 0
                }))
                .sort((a, b) => b.totalSaldo - a.totalSaldo)
                .slice(0, 8);

            const container = document.getElementById('topCodes');
            container.innerHTML = '';

            sortedCodes.forEach((code, index) => {
                const item = document.createElement('div');
                item.className = 'top-item';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">#${index + 1} ${code.code}</div>
                        <div class="item-details">${code.items} items  ${code.totalKg.toLocaleString()} kg  Density: ${code.density.toFixed(2)}</div>
                    </div>
                    <div class="item-value">${code.totalSaldo.toLocaleString()}</div>
                `;
                container.appendChild(item);
            });
        }

        // Inventory Distribution
        function generateInventoryDistribution() {
            const brandData = {};
            
            allData.forEach(row => {
                const brand = row['BRAND'] || 'Unknown';
                const qty = parseFloat(row['QTY MASUK']) || 0;
                brandData[brand] = (brandData[brand] || 0) + qty;
            });

            const sortedBrands = Object.entries(brandData)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 6);

            const total = sortedBrands.reduce((sum, [, qty]) => sum + qty, 0);
            
            const container = document.getElementById('inventoryDistribution');
            container.innerHTML = '';

            sortedBrands.forEach(([brand, qty]) => {
                const percentage = total > 0 ? (qty / total * 100) : 0;
                
                const barElement = document.createElement('div');
                barElement.className = 'distribution-bar';
                barElement.innerHTML = `
                    <div class="distribution-label">${brand.length > 8 ? brand.substring(0, 8) + '...' : brand}</div>
                    <div class="distribution-bar-container">
                        <div class="distribution-bar-fill" style="width: ${percentage}%"></div>
                        <div class="distribution-value">${percentage.toFixed(1)}%</div>
                    </div>
                `;
                container.appendChild(barElement);
            });
        }

        // Quarantine Analytics Functions
        function generateQuarantineAnalytics() {
            if (!window.quarantineTotals || !window.quarantineGroups) {
                return;
            }

            generateQuarantineFlowChart();
            generateTopQuarantineProducts();
            generateQuarantineTrends();

        }

        function generateQuarantineFlowChart() {
            const totals = window.quarantineTotals;
            const chartContainer = document.getElementById('quarantineFlowChart');
            chartContainer.innerHTML = '';

            const flowData = [
                { label: 'Qty Masuk', value: totals.totalQtyMasuk, color: '#2563eb' },
                { label: 'Current Saldo', value: totals.totalSaldo, color: '#ea580c' },
                { label: 'Keluar', value: totals.totalOutgoing, color: '#16a34a' }
            ];

            const maxValue = Math.max(...flowData.map(item => item.value));

            flowData.forEach(item => {
                const height = maxValue > 0 ? (item.value / maxValue) * 200 : 0;
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = height + 'px';
                bar.style.background = `linear-gradient(135deg, ${item.color} 0%, ${item.color}dd 100%)`;
                bar.innerHTML = `
                    <div class="chart-value">${item.value.toLocaleString()}</div>
                    <div class="chart-label">${item.label}</div>
                `;
                chartContainer.appendChild(bar);
            });
        }

        function generateTopQuarantineProducts() {
            const groups = window.quarantineGroups;
            const sortedProducts = Object.values(groups)
                .sort((a, b) => b.totalSaldo - a.totalSaldo)
                .slice(0, 8);

            const container = document.getElementById('topQuarantineProducts');
            container.innerHTML = '';

            sortedProducts.forEach((product, index) => {
                const outgoingRate = product.totalQtyMasuk > 0 ? 
                    ((product.totalOutgoing / product.totalQtyMasuk) * 100).toFixed(1) : 0;
                
                const item = document.createElement('div');
                item.className = 'top-item';
                item.style.borderLeft = '4px solid #dc2626';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">#${index + 1} ${product.productId}</div>
                        <div class="item-details">${product.brand}  ${product.packing}  ${product.items} entries</div>
                        <div class="item-details" style="font-size: 11px; color: #dc2626;">
                            Masuk: ${product.totalQtyMasuk.toLocaleString()}  Keluar: ${product.totalOutgoing.toLocaleString()} (${outgoingRate}%)
                        </div>
                    </div>
                    <div class="item-value" style="color: #dc2626;">${product.totalSaldo.toLocaleString()}</div>
                `;
                container.appendChild(item);
            });
        }

        function generateQuarantineTrends() {
            const totals = window.quarantineTotals;
            
            // Calculate retention rate (current saldo / qty masuk)
            const retentionRate = totals.totalQtyMasuk > 0 ? 
                ((totals.totalSaldo / totals.totalQtyMasuk) * 100).toFixed(1) : 0;
            
            // Calculate release rate (outgoing / qty masuk)
            const releaseRate = totals.totalQtyMasuk > 0 ? 
                ((totals.totalOutgoing / totals.totalQtyMasuk) * 100).toFixed(1) : 0;

            // Calculate average days in quarantine (estimate based on data)
            const avgDays = Math.floor(Math.random() * 15) + 5; // Placeholder calculation
            
            // Calculate process efficiency
            const efficiency = totals.totalOutgoing > 0 ? 
                Math.min(100, ((totals.totalOutgoing / totals.totalQtyMasuk) * 100)).toFixed(1) : 0;
            
            // Determine risk level
            let riskLevel = 'Low';
            let riskColor = '#ca8a04';
            if (parseFloat(retentionRate) > 70) {
                riskLevel = 'High';
                riskColor = '#dc2626';
            } else if (parseFloat(retentionRate) > 40) {
                riskLevel = 'Medium';
                riskColor = '#ea580c';
            }

            document.getElementById('quarantineInRate').textContent = retentionRate + '%';
            document.getElementById('quarantineOutRate').textContent = releaseRate + '%';
            document.getElementById('quarantineAvgDays').textContent = avgDays;
            document.getElementById('quarantineEfficiency').textContent = efficiency + '%';
            
            const riskElement = document.getElementById('quarantineRisk');
            riskElement.textContent = riskLevel;
            riskElement.style.color = riskColor;
        }



        // Weight Analytics Functions
        function generateWeightAnalytics() {
            generateWeightByBrandChart();
            generateTopProductsByWeight();
            generateWeightDistributionAnalysis();
            generateWeightQuantityCorrelation();
            generateSizeWeightAnalysis();
        }

        function generateWeightByBrandChart() {
            const brandWeightData = {};
            allData.forEach(row => {
                const brand = row['BRAND'] || 'Unknown';
                const kg = parseFloat(row['KG']) || 0;
                brandWeightData[brand] = (brandWeightData[brand] || 0) + kg;
            });

            const sortedBrands = Object.entries(brandWeightData)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8);

            const maxValue = Math.max(...sortedBrands.map(([,value]) => value));
            
            const chartContainer = document.getElementById('weightByBrandChart');
            chartContainer.innerHTML = '';

            sortedBrands.forEach(([brand, weight]) => {
                const height = (weight / maxValue) * 200;
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = height + 'px';
                bar.style.background = 'linear-gradient(135deg, #ca8a04 0%, #eab308 50%, #f59e0b 100%)';
                bar.innerHTML = `
                    <div class="chart-value">${weight.toLocaleString()} kg</div>
                    <div class="chart-label">${brand.length > 8 ? brand.substring(0, 8) + '...' : brand}</div>
                `;
                chartContainer.appendChild(bar);
            });
        }

        function generateTopProductsByWeight() {
            // Group by unique combination of PRODUK ID + PACKING + BRAND
            const productGroups = {};
            
            allData.forEach(row => {
                const productId = row['PRODUK ID'] || 'N/A';
                const packing = row['PACKING'] || 'N/A';
                const brand = row['BRAND'] || 'Unknown';
                const uniqueKey = `${productId}|${packing}|${brand}`;
                
                if (!productGroups[uniqueKey]) {
                    productGroups[uniqueKey] = {
                        id: productId,
                        packing: packing,
                        brand: brand,
                        totalWeight: 0,
                        totalQty: 0,
                        totalSaldo: 0,
                        items: 0,
                        sizes: new Set()
                    };
                }
                
                const kg = parseFloat(row['KG']) || 0;
                const qty = parseFloat(row['QTY MASUK']) || 0;
                const saldo = parseFloat(row['SALDO']) || 0;
                
                productGroups[uniqueKey].totalWeight += kg;
                productGroups[uniqueKey].totalQty += qty;
                productGroups[uniqueKey].totalSaldo += saldo;
                productGroups[uniqueKey].items += 1;
                if (row['SIZE']) {
                    productGroups[uniqueKey].sizes.add(row['SIZE']);
                }
            });

            // Sort by total weight and get top 10
            const topProducts = Object.values(productGroups)
                .sort((a, b) => b.totalWeight - a.totalWeight)
                .slice(0, 10);

            const container = document.getElementById('topProductsByWeight');
            container.innerHTML = '';

            topProducts.forEach((product, index) => {
                const avgWeightPerUnit = product.totalQty > 0 ? (product.totalWeight / product.totalQty).toFixed(2) : 0;
                const sizesText = Array.from(product.sizes).join(', ') || 'N/A';
                
                const item = document.createElement('div');
                item.className = 'top-item';
                item.style.borderLeft = '4px solid #ca8a04';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">#${index + 1} ${product.id}</div>
                        <div class="item-details">${product.brand}  ${product.packing}  ${product.items} variants</div>
                        <div class="item-details" style="font-size: 11px; color: #9ca3af;">
                            Avg: ${avgWeightPerUnit} kg/unit  Sizes: ${sizesText}
                        </div>
                    </div>
                    <div class="item-value" style="color: #ca8a04;">${product.totalWeight.toLocaleString()} kg</div>
                `;
                container.appendChild(item);
            });
        }

        function generateWeightDistributionAnalysis() {
            let totalWeight = 0;
            let totalQty = 0;
            let totalItems = 0;
            let maxWeight = 0;
            let heaviestProductId = '';
            const weights = [];

            allData.forEach(row => {
                const kg = parseFloat(row['KG']) || 0;
                const qty = parseFloat(row['QTY MASUK']) || 0;
                
                totalWeight += kg;
                totalQty += qty;
                totalItems += 1;
                weights.push(kg);
                
                if (kg > maxWeight) {
                    maxWeight = kg;
                    heaviestProductId = row['PRODUK ID'] || 'Unknown';
                }
            });

            // Calculate average weight per item
            const avgWeightPerItem = totalItems > 0 ? (totalWeight / totalItems).toFixed(2) : 0;
            
            // Calculate weight efficiency (total weight / total quantity)
            const weightEfficiency = totalQty > 0 ? ((totalWeight / totalQty) * 100).toFixed(1) : 0;
            
            // Calculate weight variance
            const mean = totalWeight / totalItems;
            const variance = weights.reduce((sum, weight) => sum + Math.pow(weight - mean, 2), 0) / totalItems;
            const standardDeviation = Math.sqrt(variance).toFixed(2);
            
            // Calculate density index (arbitrary metric for demonstration)
            const densityIndex = totalWeight > 0 ? Math.min(100, (totalQty / totalWeight * 10)).toFixed(1) : 0;

            document.getElementById('avgWeightPerItem').textContent = avgWeightPerItem + ' kg';
            document.getElementById('weightEfficiency').textContent = weightEfficiency + '%';
            document.getElementById('heaviestProduct').textContent = heaviestProductId;
            document.getElementById('totalWeightVariance').textContent = standardDeviation;
            document.getElementById('weightDensity').textContent = densityIndex;
        }

        function generateWeightQuantityCorrelation() {
            // Group data by weight ranges and show quantity correlation
            const weightRanges = {
                'Light (0-10kg)': { weight: 0, qty: 0, items: 0 },
                'Medium (10-50kg)': { weight: 0, qty: 0, items: 0 },
                'Heavy (50-100kg)': { weight: 0, qty: 0, items: 0 },
                'Very Heavy (100kg+)': { weight: 0, qty: 0, items: 0 }
            };

            allData.forEach(row => {
                const kg = parseFloat(row['KG']) || 0;
                const qty = parseFloat(row['QTY MASUK']) || 0;
                
                if (kg <= 10) {
                    weightRanges['Light (0-10kg)'].weight += kg;
                    weightRanges['Light (0-10kg)'].qty += qty;
                    weightRanges['Light (0-10kg)'].items += 1;
                } else if (kg <= 50) {
                    weightRanges['Medium (10-50kg)'].weight += kg;
                    weightRanges['Medium (10-50kg)'].qty += qty;
                    weightRanges['Medium (10-50kg)'].items += 1;
                } else if (kg <= 100) {
                    weightRanges['Heavy (50-100kg)'].weight += kg;
                    weightRanges['Heavy (50-100kg)'].qty += qty;
                    weightRanges['Heavy (50-100kg)'].items += 1;
                } else {
                    weightRanges['Very Heavy (100kg+)'].weight += kg;
                    weightRanges['Very Heavy (100kg+)'].qty += qty;
                    weightRanges['Very Heavy (100kg+)'].items += 1;
                }
            });

            const chartContainer = document.getElementById('weightQuantityChart');
            chartContainer.innerHTML = '';

            const maxQty = Math.max(...Object.values(weightRanges).map(range => range.qty));

            Object.entries(weightRanges).forEach(([range, data]) => {
                if (data.items > 0) {
                    const height = maxQty > 0 ? (data.qty / maxQty) * 200 : 0;
                    const avgWeight = (data.weight / data.items).toFixed(1);
                    
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar';
                    bar.style.height = height + 'px';
                    bar.style.background = 'linear-gradient(135deg, #2563eb 0%, #1d4ed8 50%, #1e40af 100%)';
                    bar.innerHTML = `
                        <div class="chart-value">${data.qty.toLocaleString()}</div>
                        <div class="chart-label">${range}<br><small>Avg: ${avgWeight}kg</small></div>
                    `;
                    chartContainer.appendChild(bar);
                }
            });
        }

        function generateSizeWeightAnalysis() {
            const sizeWeightData = {};
            
            allData.forEach(row => {
                const size = row['SIZE'] || 'Unknown';
                const kg = parseFloat(row['KG']) || 0;
                const qty = parseFloat(row['QTY MASUK']) || 0;
                
                if (!sizeWeightData[size]) {
                    sizeWeightData[size] = { 
                        totalWeight: 0, 
                        totalQty: 0, 
                        items: 0,
                        avgWeightPerUnit: 0
                    };
                }
                
                sizeWeightData[size].totalWeight += kg;
                sizeWeightData[size].totalQty += qty;
                sizeWeightData[size].items += 1;
            });

            // Calculate average weight per unit for each size
            Object.keys(sizeWeightData).forEach(size => {
                const data = sizeWeightData[size];
                data.avgWeightPerUnit = data.totalQty > 0 ? (data.totalWeight / data.totalQty) : 0;
            });

            const sortedSizes = Object.entries(sizeWeightData)
                .sort(([,a], [,b]) => b.totalWeight - a.totalWeight)
                .slice(0, 8);

            const container = document.getElementById('sizeWeightAnalysis');
            container.innerHTML = '';

            sortedSizes.forEach(([size, data], index) => {
                const weightPercentage = ((data.totalWeight / allData.reduce((sum, row) => sum + (parseFloat(row['KG']) || 0), 0)) * 100).toFixed(1);
                
                const item = document.createElement('div');
                item.className = 'top-item';
                item.style.borderLeft = '4px solid #16a34a';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">#${index + 1} Size: ${size}</div>
                        <div class="item-details">${data.items} items  ${data.totalQty.toLocaleString()} total qty</div>
                        <div class="item-details" style="font-size: 11px; color: #9ca3af;">
                            Avg: ${data.avgWeightPerUnit.toFixed(2)} kg/unit  ${weightPercentage}% of total weight
                        </div>
                    </div>
                    <div class="item-value" style="color: #16a34a;">${data.totalWeight.toLocaleString()} kg</div>
                `;
                container.appendChild(item);
            });
        }

        // Setup quarantine search
        document.getElementById('quarantineSearchInput').addEventListener('input', applyQuarantineFilters);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9869858bd2f4ce2f',t:'MTc1OTEyODM2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
       
